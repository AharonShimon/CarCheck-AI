<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCheck AI Pro | Ultimate Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-deep: #0b0e14;
            --bg-glass: rgba(23, 28, 41, 0.98);
            --accent: #00f0ff;
            --accent-glow: rgba(0, 240, 255, 0.35);
            --border: rgba(60, 75, 100, 0.7);
            --text-bright: #ffffff;
            --text-dim: #cbd5e1;
            --gradient: linear-gradient(135deg, #00f0ff 0%, #007aff 100%);
            --danger: #ff3b3b;
            --success: #00ff94;
            --warning: #f59e0b;
        }

        body { 
            font-family: 'Heebo', sans-serif; 
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 0%, #1a253a 0%, var(--bg-deep) 90%);
            color: var(--text-bright); margin: 0; direction: rtl; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }

        .container { padding: 25px 20px; width: 100%; max-width: 450px; box-sizing: border-box; padding-bottom: 80px; }

        header { text-align: center; margin-bottom: 25px; }
        header h1 { font-size: 32px; font-weight: 900; margin: 0; text-transform: uppercase; letter-spacing: 1px; }
        header h1 span { color: var(--accent); text-shadow: 0 0 15px var(--accent-glow); }

        /* ×œ×•×—×™×ª ×¨×™×©×•×™ ×’×“×•×œ×” ×•×‘×¨×•×¨×” */
        .plate-box { 
            background: #ffc400; padding: 6px; border-radius: 12px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); margin: 0 auto 30px auto; width: 100%; max-width: 340px;
        }
        .plate-inner { border: 3px solid #000; border-radius: 8px; display: flex; align-items: center; padding: 5px; }
        .plate-input { 
            background: none; border: none; font-size: 48px; font-weight: 900; width: 100%; 
            text-align: center; outline: none; letter-spacing: 6px; font-family: monospace; color: #000; 
        }

        /* ×©×“×•×ª ×‘×—×™×¨×” - ×’×•×‘×” ××—×™×“ ×•×‘×¨×•×¨ */
        .field-group { margin-bottom: 20px; width: 100%; position: relative; }
        label { font-size: 14px; font-weight: 700; color: var(--accent); margin-bottom: 8px; display: block; text-align: right; padding-right: 5px; }
        
        .selector-trigger {
            width: 100%; height: 60px; background: var(--bg-glass);
            border: 1px solid var(--border); border-radius: 14px;
            color: #fff; font-size: 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; 
            padding: 0 20px; box-sizing: border-box; transition: 0.2s;
        }
        .selector-trigger span { color: var(--accent); font-size: 14px; }
        .selector-trigger:active { border-color: var(--accent); background: rgba(255,255,255,0.05); }

        /* ×¤×•×¤××¤ ×‘×—×™×¨×” - ×ª×™×§×•×Ÿ ×”×’×¨×™×“ */
        .popup-grid {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #151b26; border: 1px solid var(--accent); border-radius: 16px;
            padding: 15px; z-index: 9999; margin-top: 8px; box-shadow: 0 30px 60px rgba(0,0,0,1);
            max-height: 400px; overflow-y: auto;
        }
        .popup-grid.active { display: block; animation: slideUp 0.2s ease-out; }

        .search-input {
            width: 100%; padding: 12px; margin-bottom: 12px;
            background: #0b0e14; border: 1px solid var(--border); border-radius: 8px;
            color: white; font-size: 16px; box-sizing: border-box; text-align: right; outline: none;
        }
        .search-input:focus { border-color: var(--accent); }

        .grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .grid-item { 
            padding: 12px 4px; text-align: center; background: #1f2937; border-radius: 8px; 
            font-size: 14px; font-weight: 600; cursor: pointer; color: #e2e8f0; 
            border: 1px solid transparent; min-height: 45px; display: flex; align-items: center; justify-content: center;
            line-height: 1.2; word-break: break-word;
        }
        .grid-item:hover { background: var(--accent); color: #000; border-color: var(--accent); }

        /* ×›×¤×ª×•×¨×™× ×’×“×•×œ×™× ×•× ×•×—×™× */
        .btn-main {
            width: 100%; padding: 18px; border-radius: 14px; border: none;
            font-size: 18px; font-weight: 800; cursor: pointer; color: white;
            background: var(--gradient); box-shadow: 0 10px 30px rgba(0, 122, 255, 0.4); margin-top: 15px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-main:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 1.5px solid var(--border); margin-top: 15px; color: var(--text-dim); }

        /* ×¦'×§ ×œ×™×¡×˜ - ×ª×™×§×•×Ÿ UX ×§×¨×™×˜×™ */
        #screen-check { display: none; width: 100%; flex-direction: column; align-items: center; }
        .category-header { width: 100%; margin: 30px 0 15px 0; padding-bottom: 5px; border-bottom: 2px solid var(--accent); text-align: right; }
        .category-title { color: var(--accent); font-size: 20px; font-weight: 900; }

        .check-item { 
            width: 100%; background: var(--bg-glass); padding: 16px; border-radius: 14px; 
            margin-bottom: 12px; border: 1px solid var(--border); display: flex; flex-direction: column;
            box-sizing: border-box; transition: 0.3s;
        }
        .check-item-header { display: flex; justify-content: space-between; align-items: center; width: 100%; gap: 15px; }
        
        /* ××–×•×¨ ×œ×—×™×¦×” ×¨××©×™ - ×¦'×§×‘×•×§×¡ ×•×˜×§×¡×˜ ×¦××•×“×™× */
        .main-click-area { display: flex; align-items: center; gap: 15px; flex-grow: 1; cursor: pointer; }
        .cb-custom { 
            width: 32px; height: 32px; border: 2px solid var(--border); border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); flex-shrink: 0;
        }
        .cb-custom.bad { background: var(--danger); border-color: var(--danger); box-shadow: 0 0 15px rgba(255, 59, 59, 0.5); }
        .cb-custom.bad:after { content: 'âœ•'; color: white; font-weight: 900; font-size: 22px; }
        .item-name { font-weight: 700; font-size: 16px; color: #fff; line-height: 1.4; }

        /* ×›×¤×ª×•×¨ ××™×“×¢ × ×¤×¨×“ ××©×××œ */
        .info-btn { 
            background: rgba(0, 240, 255, 0.1); color: var(--accent); border: 1px solid var(--accent);
            width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 18px; cursor: pointer; font-weight: bold; flex-shrink: 0;
        }

        .how-to-box { 
            display: none; background: rgba(0, 122, 255, 0.1); border: 1px solid rgba(0, 122, 255, 0.3);
            padding: 15px; border-radius: 10px; margin-top: 15px; font-size: 14px; color: #bae6fd; line-height: 1.6;
        }
        .ok-status { color: var(--success); font-weight: bold; margin-top: 8px; border-right: 3px solid var(--success); padding-right: 8px; }

        /* ×× ×™××¦×™×•×ª */
        #loader { display: none; position: fixed; inset: 0; background: var(--bg-deep); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .orbit { width: 60px; height: 60px; border: 4px solid var(--accent-glow); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* ×ª×•×¦××•×ª */
        #screen-result { display: none; text-align: center; }
        .final-gauge { width: 180px; height: 180px; border-radius: 50%; border: 12px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 64px; font-weight: 900; margin: 30px auto; background: var(--bg-glass); box-shadow: 0 0 40px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="loader"><div class="orbit"></div><div style="margin-top:20px; color:var(--accent); font-weight:bold;">××¢×‘×“ × ×ª×•× ×™×...</div></div>

<div id="screen-input" class="container">
    <header><h1>CARCHECK <span>AI ULTIMATE</span></h1></header>
    
    <div class="plate-box"><div class="plate-inner"><input id="plate" class="plate-input" type="tel" placeholder="00000000" maxlength="8"></div></div>
    
    <button class="btn-main" style="background: #1f2937; margin-bottom: 35px; font-size:16px;" onclick="alert('×”××¢×¨×›×ª ×ª×—×•×‘×¨ ×œ×××’×¨ ××©×¨×“ ×”×ª×—×‘×•×¨×” ×‘×§×¨×•×‘')">ğŸ” ××™×ª×•×¨ ×œ×¤×™ ××¡×¤×¨ ×¨×™×©×•×™</button>

    <div class="field-group">
        <label>×™×¦×¨×Ÿ ×¨×›×‘</label>
        <div id="brand-trigger" class="selector-trigger" onclick="window.handlePicker('brand')">×‘×—×¨ ×™×¦×¨×Ÿ... <span>â–¼</span></div>
        <div id="brand-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×™×¦×¨×Ÿ..." onkeyup="window.filterGrid('brand', this.value)">
            <div id="brand-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-b">
    </div>

    <div class="field-group">
        <label>×“×’×</label>
        <div id="model-trigger" class="selector-trigger" onclick="window.handlePicker('model')">×‘×—×¨ ×“×’×... <span>â–¼</span></div>
        <div id="model-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×“×’×..." onkeyup="window.filterGrid('model', this.value)">
            <div id="model-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-m">
    </div>

    <div class="field-group">
        <label>×©× ×ª ×™×™×¦×•×¨</label>
        <div id="year-trigger" class="selector-trigger" onclick="window.handlePicker('year')">×‘×—×¨ ×©× ×”... <span>â–¼</span></div>
        <div id="year-popup" class="popup-grid">
            <div style="display:flex; justify-content:space-between; margin-bottom:12px; color:var(--accent); font-weight:900; padding: 0 10px; font-size:20px;">
                <span onclick="event.stopPropagation(); window.shiftY(-1)" style="cursor:pointer;">â®</span>
                <span id="y-range-text" style="font-size:16px;"></span>
                <span onclick="event.stopPropagation(); window.shiftY(1)" style="cursor:pointer;">â¯</span>
            </div>
            <div id="year-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-y">
    </div>
    
    <button class="btn-main" onclick="window.startAI()">ğŸš€ × ×™×ª×•×— ××—×œ×•×ª AI</button>
    <button class="btn-main btn-outline" onclick="window.goToChecklist()">ğŸ“ ×“×œ×’ ×œ×‘×“×™×§×ª ×©×˜×—</button>
    
    <div id="ai-panel" style="margin-top: 30px;"></div>
</div>

<div id="screen-check" class="container">
    <header><h1>×‘×“×™×§×ª <span>×©×˜×—</span></h1><p style="font-size:14px; color:var(--text-dim); margin-top:-10px;">×œ×—×¥ ×¢×œ ×”×¨×™×‘×•×¢ ×œ×¡×™××•×Ÿ ×ª×§×œ×” | â„¹ï¸ ×œ×”×¡×‘×¨</p></header>
    <div id="checklist-content" style="width: 100%;"></div>
    <div style="position:sticky; bottom:20px; width:100%; background:var(--bg-deep); padding:15px 0; border-top:1px solid var(--border);">
        <button class="btn-main" style="background: var(--success); color: #000;" onclick="window.finishCheck()">ğŸ“Š ×©×§×œ×œ ×¦×™×•×Ÿ ×•×¡×™×™×</button>
    </div>
</div>

<div id="screen-result" class="container">
    <header><h1>×ª×•×¦××ª <span>×‘×“×™×§×”</span></h1></header>
    <div id="final-gauge" class="final-gauge">0</div>
    <div id="result-text" style="text-align:center; font-size:20px; margin-bottom:30px; line-height:1.6; font-weight:700;"></div>
    <button class="btn-main" style="background:#4285F4; margin-bottom:15px;" onclick="window.findGarage()">ğŸ“ × ×•×•×˜ ×œ××›×•×Ÿ ×‘×“×™×§×” (Waze)</button>
    <button class="btn-main btn-outline" onclick="location.reload()">ğŸ”„ ×‘×“×™×§×” ×—×“×©×”</button>
</div>

<script>
// === ×××’×¨ ×¨×›×‘×™× ××œ× (×›×œ ××” ×©×‘×™×§×©×ª!) ===
const carDatabase = {
    "×¡×•×‘××¨×•": ["XV", "×¤×•×¨×¡×˜×¨", "×××•×˜×‘×§", "××™××¤×¨×–×”", "B4", "×§×¨×•×¡×˜×¨×§", "STI", "BRZ", "DL"],
    "×¡×•×–×•×§×™": ["×¡×•×•×™×¤×˜", "×•×™×˜××¨×”", "×’'×™×× ×™", "×§×¨×•×¡××•×‘×¨", "×‘××œ× ×•", "××™×’× ×™×¡", "××œ×˜×•", "×¡×œ×¨×™×•"],
    "×˜×•×™×•×˜×”": ["×§×•×¨×•×œ×”", "×™××¨×™×¡", "RAV4", "C-HR", "×œ× ×“ ×§×¨×•×–×¨", "×¤×¨×™×•×¡", "×”×™×™×œ×§×¡", "×§×××¨×™", "×™××¨×™×¡ ×§×¨×•×¡", "×§×•×¨×•×œ×” ×§×¨×•×¡", "××™×™×’×• X"],
    "×™×•× ×“××™": ["i10", "i20", "i30", "××™×•× ×™×§ 5", "××™×•× ×™×§ 6", "×˜×•×¡×•×Ÿ", "×¡× ×˜×” ×¤×”", "×§×•× ×”", "××œ× ×˜×¨×”", "×‘××™×•×Ÿ", "×•×œ×•×¡×˜×¨", "i25"],
    "×§×™×”": ["×¤×™×§× ×˜×•", "×¡×¤×•×¨×˜××–'", "× ×™×¨×•", "×¡×˜×•× ×™×§", "×¡×•×¨× ×˜×•", "×§×¨× ×™×‘×œ", "EV6", "EV9", "×¡×™×“", "×¨×™×•", "××•×¤×˜×™××”", "×¡×œ×˜×•×¡"],
    "×××–×“×”": ["2", "3", "6", "CX-3", "CX-5", "CX-30", "CX-60", "CX-9", "MX-5"],
    "×¡×§×•×“×”": ["××•×§×˜×‘×™×”", "×¡×•×¤×¨×‘", "×§×•×“×™××§", "×§××¨×•×§", "×§×××™×§", "×¤××‘×™×”", "×¡×§××œ×”", "×× ×™×™××§", "×™×™×˜×™"],
    "×¤×•×œ×§×¡×•×•×’×Ÿ": ["×’×•×œ×£", "×¤×•×œ×•", "×˜×™×’×•××Ÿ", "×¤××¡××˜", "ID.4", "T-Roc", "×˜×•×¨××Ÿ", "×’'×˜×”", "×—×™×¤×•×©×™×ª"],
    "×××•×“×™": ["A1", "A3", "A4", "A5", "A6", "Q2", "Q3", "Q5", "Q7", "e-tron"],
    "××¨×¦×“×¡": ["A-Class", "C-Class", "E-Class", "S-Class", "GLA", "GLC", "GLE", "EQE", "EQS", "CLA"],
    "×‘.×.×•×•": ["×¡×“×¨×” 1", "×¡×“×¨×” 2", "×¡×“×¨×” 3", "×¡×“×¨×” 4", "×¡×“×¨×” 5", "X1", "X3", "X5", "X6", "i4"],
    "×©×‘×¨×•×œ×˜": ["×¡×¤××¨×§", "×˜×¨××•×•×¨×¡", "××§×•×•×™× ×•×§×¡", "×‘×œ×™×™×–×¨", "×¡×™×œ×‘×¨×“×•", "×××œ×™×‘×•", "×§×¨×•×–"],
    "××™×¦×•×‘×™×©×™": ["×××•×˜×œ× ×“×¨", "ASX", "×¡×¤×™×™×¡ ×¡×˜××¨", "××§×œ×™×¤×¡ ×§×¨×•×¡", "×œ× ×¡×¨", "×¤××’'×¨×•", "×”×× ×˜×¨"],
    "×¤×•×¨×“": ["×¤×•×§×•×¡", "×§×•×’×”", "××§×¡×¤×œ×•×¨×¨", "×‘×¨×•× ×§×•", "××•×¡×˜× ×’", "×¨×™×™× ×’'×¨", "×¤×™××¡×˜×”"],
    "×¡×™××˜": ["××™×‘×™×–×”", "×œ××•×Ÿ", "××¨×•× ×”", "××˜×§×”", "×˜×¨××§×•"],
    "BYD": ["Atto 3", "Dolphin", "Seal", "Tang", "Han"],
    "MG": ["MG4", "MG5", "ZS EV", "EHS", "Marvel R", "MG3"],
    "×œ×§×¡×•×¡": ["NX", "RX", "UX", "ES", "IS", "LS"],
    "×’'× ×¡×™×¡": ["G70", "G80", "G90", "GV60", "GV70", "GV80"],
    "×§×•×¤×¨×”": ["×¤×•×¨×× ×˜×•×¨", "×œ××•×Ÿ", "××˜×§×”", "×‘×•×¨×Ÿ"]
};

// === 34 ×‘×“×™×§×•×ª ×©×˜×— ××œ××•×ª ===
const checklistData = [
    {
        category: "×× ×•×¢ ×•××¢×¨×›×ª ×§×™×¨×•×¨ (×§×¨×™×˜×™ ×‘×™×•×ª×¨)",
        items: [
            { name: "×‘×“×™×§×ª '×˜×—×™× ×”' ×‘×©××Ÿ", weight: 25, howTo: "×¤×ª×— ×¤×§×§ ××™×œ×•×™ ×©××Ÿ. ×”×× ×™×© ×§×¦×£ ×œ×‘×Ÿ/×—×•×?", ok: "×”×©××Ÿ × ×§×™, ×©×—×•×¨ ××• ×—×•×, ×œ×œ× ×§×¦×£." },
            { name: "×‘×•×¢×•×ª ×‘××™×›×œ ×¢×™×‘×•×™", weight: 25, howTo: "×›×©×”×× ×•×¢ ×¢×•×‘×“, ×”×¡×ª×›×œ ×‘××™×›×œ ×”××™×. ×”×× ×¢×•×œ×•×ª ×‘×•×¢×•×ª?", ok: "×”××™× ×¨×’×•×¢×™× ×œ×—×œ×•×˜×™×Ÿ ×œ×œ× ×‘×•×¢×•×ª ××•×•×™×¨." },
            { name: "× ×©×™××ª ×× ×•×¢ (Blow-By)", weight: 25, howTo: "×”× ×— ××ª ×¤×§×§ ×”×©××Ÿ ×”×¤×•×š ×¢×œ ×”×¤×ª×— ×›×©×”×× ×•×¢ ×“×•×œ×§. ×”×× ×”×•× ×¢×£?", ok: "×”×¤×§×§ ×¨×•×¢×“ ×§×œ×•×ª ×‘××§×•× ×•×œ× ×¢×£." },
            { name: "×¨×™×— ×‘× ×–×™×Ÿ ×—×¨×™×£", weight: 25, howTo: "×”×¨×— ×¡×‘×™×‘ ×”×× ×•×¢ ×•×‘×ª×•×š ×”×¨×›×‘ (××•×©×‘ ××—×•×¨×™). ×”×× ×™×© ×¨×™×— ×“×œ×§?", ok: "××™×Ÿ ×©×•× ×¨×™×— ×©×œ ×“×œ×§." },
            { name: "×‘×•×¥ ×©××Ÿ (Sludge)", weight: 20, howTo: "×”××¨ ×¢× ×¤× ×¡ ×œ×ª×•×š ×¤×ª×— ××™×œ×•×™ ×”×©××Ÿ. ×”×× ×™×© ××©×§×¢ ×©×—×•×¨ ×¡××™×š?", ok: "×—×œ×§×™ ×”××ª×›×ª ×‘×¤× ×™× × ×¨××™× × ×§×™×™×." },
            { name: "× ×–×™×œ×•×ª ×©××Ÿ/××™×", weight: 15, howTo: "×”×¡×ª×›×œ ××ª×—×ª ×œ×¨×›×‘ ×•×¢×œ ×”×‘×œ×•×§. ×”×× ×™×© ×¨×˜×™×‘×•×ª?", ok: "×”×× ×•×¢ ×™×‘×© ×•××‘×§×ª×™, ×œ×œ× ×‘×¨×§ ×©×œ ×©××Ÿ." },
            { name: "×¦×‘×¢ × ×•×–×œ ×§×™×¨×•×¨", weight: 10, howTo: "×”×× ×”××™× ×‘×¦×‘×¢ ×—×œ×•×“×” ××• ×©×§×•×¤×™×?", ok: "×”× ×•×–×œ ×‘×¦×‘×¢ ××§×•×¨×™ (×•×¨×•×“/×™×¨×•×§) ×•×¦×œ×•×œ." },
            { name: "×¨×¢×©×™ ×©×¡×ª×•××™×", weight: 15, howTo: "×”×§×©×‘ ×œ×× ×•×¢ ×‘×¡×¨×§. ×”×× ×™×© ×ª×§×ª×•×§×™× ××ª×›×ª×™×™×?", ok: "×–××–×•× ××—×™×“ ×•×©×§×˜." },
            { name: "×œ×—×¥ ×‘×¦× ×¨×ª ×¨×“×™××˜×•×¨", weight: 15, howTo: "×›×©×”×× ×•×¢ ×—×, ×œ×—×¥ ×¢×œ ×”×¦×™× ×•×¨ ×”×¢×œ×™×•×Ÿ. ×”×× ×”×•× ×§×©×” ×›××‘×Ÿ?", ok: "×”×¦×™× ×•×¨ ×—× ×•×’××™×© ××¢×˜ ×‘×œ×—×™×¦×”." },
            { name: "×××•×•×¨×¨ ×¨×“×™××˜×•×¨", weight: 15, howTo: "×”×¤×¢×œ ××–×’×Ÿ. ×”×× ×”×××•×•×¨×¨ × ×›× ×¡ ×œ×¤×¢×•×œ×”?", ok: "×”×××•×•×¨×¨ ×¢×•×‘×“ ×—×–×§ ××™×“." }
        ]
    },
    {
        category: "×’×™×¨ ×•××¢×¨×›×ª ×”× ×¢×”",
        items: [
            { name: "××›×” ×‘×©×™×œ×•×‘ ×”×™×œ×•×š", weight: 15, howTo: "×”×¢×‘×¨ ×‘×™×Ÿ P ×œ-D ×•-R. ×”×× ×™×© ××›×”?", ok: "×”×”×™×œ×•×š × ×›× ×¡ ×‘×¨×›×•×ª ×•×‘×©×§×˜." },
            { name: "×”×—×œ×§×” ×‘×”××¦×”", weight: 20, howTo: "×ª×Ÿ ×’×– ×—×–×§ ×‘× ×¡×™×¢×”. ×”×× ×”×˜×•×¨×™× ×¢×•×œ×™× ×•×”×¨×›×‘ ×œ×?", ok: "×”×¨×›×‘ ×××™×¥ ×‘×™×—×¡ ×™×©×¨ ×œ×˜×•×¨×™×." },
            { name: "×¨×¢×©×™ ×¦×™×¨×™×•×ª", weight: 15, howTo: "×¡×•×‘×‘ ×”×’×” ×¢×“ ×”×¡×•×£ ×•×¡×¢ ×œ××˜. ×”×× ×™×© '×§×œ×™×§-×§×œ×™×§'?", ok: "× ×¡×™×¢×” ×©×§×˜×” ×’× ×‘×¡×™×‘×•×‘ ××œ×." },
            { name: "×¨×¢×™×“×•×ª ×‘× ×¡×™×¢×”", weight: 15, howTo: "×”×× ×”×”×’×” ××• ×”×¨×›×‘ ×¨×•×¢×“×™× ×‘-100 ×§×\"×©?", ok: "× ×¡×™×¢×” ×—×œ×§×” ×•×™×¦×™×‘×”." }
        ]
    },
    {
        category: "×©×œ×“×”, ××¨×›×‘ ×•×ª××•× ×•×ª",
        items: [
            { name: "××‘×—×Ÿ ×”××’× ×˜", weight: 15, howTo: "×¢×‘×•×¨ ×¢× ××’× ×˜ ×¢×œ ×”×›× ×¤×™×™×. ×”×× ×”×•× × ×•×¤×œ (×©×¤×›×˜×œ)?", ok: "×”××’× ×˜ × ×¦××“ ×—×–×§ ×‘×›×œ × ×§×•×“×”." },
            { name: "× ×§×•×“×•×ª ×¨×™×ª×•×š", weight: 20, howTo: "××©×•×š ×’×•××™×•×ª ×“×œ×ª. ×”×× ×”×¨×™×ª×•×›×™× ×¢×’×•×œ×™× ×•××§×•×¨×™×™×?", ok: "× ×§×•×“×•×ª ×©×§×•×¢×•×ª, ×§×˜× ×•×ª ×•××—×™×“×•×ª." },
            { name: "×‘×¨×’×™ ×›× ×¤×™×™×", weight: 12, howTo: "×”×× ×™×© ×§×™×œ×•×£ ×¦×‘×¢ ×¢×œ ×”×‘×¨×’×™× ×‘×ª× ×”×× ×•×¢?", ok: "×”×‘×¨×’×™× ×¦×‘×•×¢×™× ×‘×¦×‘×¢ ×”×¨×›×‘ ×œ×œ× ×¡×™×× ×™ ××¤×ª×—." },
            { name: "×¡×™××˜×¨×™×” ×‘××¨×•×•×—×™×", weight: 12, howTo: "×”×× ×”×¨×•×•×—×™× ×‘×™×Ÿ ×”×“×œ×ª×•×ª ×©×•×•×™× ×‘×©× ×™ ×”×¦×“×“×™×?", ok: "×§×•×•×™× ×™×©×¨×™× ×•×¨×•×•×—×™× ××—×™×“×™×." },
            { name: "×¨×˜×™×‘×•×ª ×‘×ª× ××˜×¢×Ÿ", weight: 15, howTo: "×”×¨× ××ª ×”×©×˜×™×— ×‘×‘×’××–'. ×”×× ×™×© ××™× ××• ×—×œ×•×“×”?", ok: "×”×¤×— × ×§×™, ×™×‘×© ×•×—×“×©." },
            { name: "×”×‘×“×œ×™ ×¦×‘×¢", weight: 10, howTo: "×”×¡×ª×›×œ ×‘×©××©. ×”×× ×“×œ×ª ××—×ª ×›×”×” ××”×©× ×™×™×”?", ok: "×¦×‘×¢ ××—×™×“ ×œ×—×œ×•×˜×™×Ÿ ×‘×›×œ ×”×¨×›×‘." }
        ]
    },
    {
        category: "×—×©××œ, ×¤× ×™× ×•×–×”×•×ª",
        items: [
            { name: "×–×”×•×ª ×”××•×›×¨", weight: 30, howTo: "×”×©×•×•×” ×ª×¢×•×“×ª ×–×”×•×ª ×œ×¨×™×©×™×•×Ÿ ×”×¨×›×‘.", ok: "×”××•×›×¨ ×”×•× ×‘×¢×œ ×”×¨×›×‘ ×”×¨×©×•×." },
            { name: "× ×•×¨×•×ª ××–×”×¨×”", weight: 20, howTo: "×”× ×¢. ×”×× × ×©××¨×ª × ×•×¨×” ×“×•×œ×§×ª ×‘×œ×•×—?", ok: "×›×œ ×”× ×•×¨×•×ª (×× ×•×¢, ×›×¨×™×ª ××•×•×™×¨) × ×›×‘×•×ª." },
            { name: "××–×’×Ÿ (×§×•×¨/×—×•×)", weight: 10, howTo: "×‘×“×•×§ ×§×™×¨×•×¨ ×•×—×™××•×.", ok: "×”×©×™× ×•×™ ×‘×˜××¤×¨×˜×•×¨×” ××™×™×“×™." },
            { name: "×—×œ×•× ×•×ª ×•××¨××•×ª", weight: 5, howTo: "×‘×“×•×§ ×©×›×œ ×”×›×¤×ª×•×¨×™× ×¢×•×‘×“×™×.", ok: "×”×›×œ ×¢×•×‘×“ ×—×œ×§ ×•×œ×œ× ×¨×¢×©×™× ××•×–×¨×™×." },
            { name: "× ×–×§×™ ×”×¦×¤×”", weight: 20, howTo: "×—×¤×© ×—×•×œ ××• ×¨×™×— ×¢×•×‘×© ××ª×—×ª ×œ×©×˜×™×—×™×.", ok: "×¨×™×— × ×§×™ ×•×¨×¦×¤×” ×™×‘×©×”." }
        ]
    }
];

let yBase = 2018; let currentScore = 100;

window.handlePicker = function(type) {
    const target = document.getElementById(type + '-popup');
    const isOpen = target.classList.contains('active');
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
    if (!isOpen) {
        target.classList.add('active');
        if(type === 'brand') renderGrid('brand', Object.keys(carDatabase));
        if(type === 'year') renderYears();
        if(type === 'model') renderGrid('model', carDatabase[document.getElementById('val-b').value] || []);
    }
};

function renderGrid(type, items, query = "") {
    const g = document.getElementById(type + '-grid'); g.innerHTML = '';
    items.sort((a,b) => a.localeCompare(b, 'he'));

    if (items.length === 0 && query.length > 0) {
        const d = document.createElement('div'); d.className = 'grid-item'; d.style.gridColumn = "1/-1";
        d.innerHTML = `×”×©×ª××© ×‘-"${query}" â•`;
        d.onclick = () => selectItem(type, query);
        g.appendChild(d);
        return;
    }

    items.forEach(item => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = item;
        d.onclick = () => selectItem(type, item);
        g.appendChild(d);
    });
}

function selectItem(type, value) {
    document.getElementById('val-' + type.charAt(0)).value = value;
    document.getElementById(type + '-trigger').innerHTML = `${value} <span>â–¼</span>`;
    if(type === 'brand') { document.getElementById('val-m').value = ''; document.getElementById('model-trigger').innerHTML = `×‘×—×¨ ×“×’×... <span>â–¼</span>`; }
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
}

window.filterGrid = function(type, query) {
    let source = type === 'brand' ? Object.keys(carDatabase) : (carDatabase[document.getElementById('val-b').value] || []);
    renderGrid(type, source.filter(i => i.toLowerCase().includes(query.toLowerCase())), query);
};

function renderYears() {
    const g = document.getElementById('year-grid'); g.innerHTML = '';
    document.getElementById('y-range-text').innerText = `${yBase}-${yBase+8}`;
    for(let i=0; i<9; i++){
        let y = yBase+i; let d = document.createElement('div'); d.className = 'grid-item'; d.innerText = y;
        d.onclick = () => selectItem('year', y);
        g.appendChild(d);
    }
}
window.shiftY = function(n) { yBase += (n * 9); renderYears(); };

window.startAI = async function() {
    const b = document.getElementById('val-b').value;
    const m = document.getElementById('val-m').value;
    const y = document.getElementById('val-y').value;
    if(!b || !m || !y) return alert("×× × ×‘×—×¨ ×¨×›×‘ ××œ×");
    document.getElementById('loader').style.display = 'flex';
    try {
        const res = await fetch('/analyze-ai', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ brand: b, model: m, year: y }) });
        const data = await res.json();
        if(data.success) {
            const ai = data.aiAnalysis;
            const p = document.getElementById('ai-panel'); p.style.display = 'block';
            p.innerHTML = `<div class="ai-card">
                <div class="ai-score-big">${ai.reliability_score}</div>
                <p style="text-align:center; font-weight:bold;">${ai.summary}</p>
                <div style="color:var(--success); margin-top:10px;">âœ… ×™×ª×¨×•× ×•×ª:</div>
                <ul class="list-ul">${(ai.pros || []).map(p => `<li>${p}</li>`).join('')}</ul>
                <div style="color:var(--danger); margin-top:10px;">âŒ ×—×¡×¨×•× ×•×ª:</div>
                <ul class="list-ul">${(ai.cons || []).map(c => `<li>${c}</li>`).join('')}</ul>
                <button class="btn-main" onclick="window.goToChecklist()" style="margin-top:15px; background:var(--accent); color:#000;">ğŸ“ ×”××©×š ×œ×‘×“×™×§×”</button>
            </div>`;
            p.scrollIntoView({ behavior: 'smooth' });
        }
    } catch(e) { alert("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª ×”-AI"); }
    finally { document.getElementById('loader').style.display = 'none'; }
};

window.goToChecklist = function() {
    document.getElementById('screen-input').style.display = 'none';
    document.getElementById('screen-check').style.display = 'flex';
    const content = document.getElementById('checklist-content'); content.innerHTML = '';
    currentScore = 100;
    checklistData.forEach((cat, cIdx) => {
        content.innerHTML += `<div class="category-header"><span class="category-title">${cat.category}</span></div>`;
        cat.items.forEach((item, iIdx) => {
            const id = `cb-${cIdx}-${iIdx}`;
            content.innerHTML += `<div class="check-item">
                <div class="check-item-header">
                    <div class="main-click-area" onclick="window.toggleCheck('${id}', ${item.weight})">
                        <div id="${id}" class="cb-custom"></div>
                        <span class="item-name">${item.name}</span>
                    </div>
                    <div class="info-btn" onclick="window.toggleHow('${id}')">i</div>
                </div>
                <div id="how-${id}" class="how-to-box">
                    <strong>××™×š ×‘×•×“×§×™×?</strong><br>${item.howTo}
                    <div class="ok-status">×ª×§×™×Ÿ: ${item.ok}</div>
                </div>
            </div>`;
        });
    });
    window.scrollTo(0,0);
};

window.toggleCheck = (id, weight) => {
    const el = document.getElementById(id);
    const isBad = el.classList.contains('bad');
    el.classList.toggle('bad');
    currentScore += isBad ? weight : -weight;
};

window.toggleHow = (id) => { const el = document.getElementById('how-'+id); el.style.display = el.style.display === 'block' ? 'none' : 'block'; };

window.finishCheck = () => {
    document.getElementById('screen-check').style.display = 'none';
    document.getElementById('screen-result').style.display = 'flex';
    const score = Math.max(0, currentScore);
    const g = document.getElementById('final-gauge'); g.innerText = score;
    let color = score > 85 ? "var(--success)" : (score > 60 ? "var(--warning)" : "var(--danger)");
    g.style.borderColor = color; g.style.color = color;
    document.getElementById('result-text').innerText = score > 85 ? "×”×¨×›×‘ ×‘××¦×‘ ××¦×•×™×Ÿ! ××•××œ×¥ ×œ×§× ×™×™×” âœ…" : (score > 60 ? "××¦×‘ ×¡×‘×™×¨. ×“×•×¨×© ×‘×“×™×§×” ××§×¦×•×¢×™×ª ×‘××•×¡×š âš ï¸" : "×œ× ××•××œ×¥ ×œ×§× ×™×™×”. ×œ×™×§×•×™×™× ×—××•×¨×™× âŒ");
};

window.findGarage = () => {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => {
            window.open(`https://waze.com/ul?q=××›×•×Ÿ%20×‘×“×™×§×ª%20×¨×›×‘&ll=${p.coords.latitude},${p.coords.longitude}&navigate=yes`, '_blank');
        }, () => window.open(`https://waze.com/ul?q=××›×•×Ÿ%20×‘×“×™×§×ª%20×¨×›×‘&navigate=yes`, '_blank'));
    }
};

document.addEventListener('click', (e) => { if(!e.target.closest('.field-group')) document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active')); });
</script>
</body>
</html>
