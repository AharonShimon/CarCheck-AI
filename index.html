<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCheck AI Pro | Live Edition</title>
    <style>
        :root { 
            --bg-deep: #0b0e14;
            --bg-glass: rgba(23, 28, 41, 0.95);
            --accent: #00f0ff;
            --accent-glow: rgba(0, 240, 255, 0.25);
            --border: rgba(42, 59, 85, 0.6);
            --text-bright: #ffffff;
            --text-dim: #94a3b8;
            --gradient: linear-gradient(135deg, #00f0ff 0%, #007aff 100%);
            --danger: #ff3b3b;
            --success: #00ff94;
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 0%, #1a253a 0%, var(--bg-deep) 80%);
            color: var(--text-bright); margin: 0; direction: rtl; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { padding: 30px 20px; width: 100%; max-width: 450px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; }

        /* ×›×•×ª×¨×•×ª ×•×œ×•×’×• */
        header { text-align: center; margin-bottom: 30px; width: 100%; }
        header h1 { font-size: 26px; font-weight: 900; letter-spacing: 2px; margin: 0; text-transform: uppercase; }
        header h1 span { color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }

        /* ×œ×•×—×™×ª ×¨×™×©×•×™ */
        .plate-box { background: #ffc400; padding: 4px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 30px; width: 100%; max-width: 320px; }
        .plate-inner { border: 2px solid #000; border-radius: 7px; display: flex; align-items: center; padding: 6px; }
        .plate-input { background: none; border: none; font-size: 38px; font-weight: 900; width: 100%; text-align: center; outline: none; letter-spacing: 4px; font-family: monospace; color: #000; }

        /* ×©×“×•×ª ×‘×—×™×¨×” (Pickers) */
        .field-group { margin-bottom: 22px; width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; }
        label { font-size: 12px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 8px; width: 100%; text-align: center; }
        
        .selector-trigger {
            width: 100%; padding: 16px 20px; background: var(--bg-glass);
            backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 14px;
            color: #fff; font-size: 16px; cursor: pointer; display: flex; justify-content: center; align-items: center; position: relative;
            transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .selector-trigger:active { transform: scale(0.98); border-color: var(--accent); }
        .selector-trigger:after { content: 'â–¼'; font-size: 10px; color: var(--accent); position: absolute; left: 20px; }
        .selector-trigger.active { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

        /* ×—×œ×•× ×™×ª ×”×’×¨×™×“ */
        .popup-grid {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #111827; border: 1px solid var(--accent); border-radius: 16px;
            padding: 15px; z-index: 1000; margin-top: 8px; box-shadow: 0 25px 50px rgba(0,0,0,0.9);
            max-height: 300px; overflow-y: auto;
        }
        .popup-grid.active { display: block; animation: slideUp 0.2s ease-out; }

        .grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
        .grid-item { 
            padding: 12px 5px; text-align: center; background: #1f2937; border-radius: 8px; 
            font-size: 13px; font-weight: 600; cursor: pointer; color: #d1d5db; border: 1px solid transparent; 
        }
        .grid-item:hover { border-color: var(--accent); color: var(--accent); background: rgba(0, 240, 255, 0.05); }

        .btn-main {
            width: 100%; padding: 18px; border-radius: 14px; border: none;
            font-size: 17px; font-weight: 800; cursor: pointer; color: white;
            background: var(--gradient); box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3); margin-top: 10px; text-align: center;
        }

        /* ×ª×•×¦××•×ª AI */
        .ai-panel { margin-top: 35px; display: none; width: 100%; text-align: center; }
        .ai-card { background: var(--bg-glass); padding: 20px; border-radius: 16px; border-bottom: 4px solid var(--accent); margin-bottom: 15px; }

        /* ×¦'×§ ×œ×™×¡×˜ ××©×•×¤×¨ */
        #screen-check { display: none; width: 100%; flex-direction: column; align-items: center; }
        
        /* ×œ×•×’×• ×™×¦×¨×Ÿ */
        .brand-logo-container { width: 100%; display: flex; justify-content: center; margin-bottom: 15px; }
        .brand-logo-img { height: 60px; width: auto; filter: drop-shadow(0 0 10px var(--accent-glow)); }
        
        .category-header { width: 100%; margin: 35px 0 15px 0; text-align: center; }
        .category-title { color: var(--text-bright); font-size: 18px; font-weight: 700; letter-spacing: 1px; }
        .category-line { width: 60px; height: 2px; background: var(--gradient); margin: 5px auto 0 auto; border-radius: 2px; }

        .check-item { 
            width: 100%; background: var(--bg-glass); padding: 16px; border-radius: 12px; 
            margin-bottom: 10px; border: 1px solid var(--border); display: flex; 
            justify-content: space-between; align-items: center; box-sizing: border-box;
        }

        .cb-custom { width: 26px; height: 26px; border: 2px solid var(--border); border-radius: 6px; cursor: pointer; transition: 0.3s; flex-shrink: 0; }
        .cb-custom.checked { background: var(--danger); border-color: var(--danger); display: flex; align-items: center; justify-content: center; }
        .cb-custom.checked:after { content: 'âœ•'; color: white; font-weight: 900; font-size: 14px; }
        
        .item-text-wrapper { display: flex; align-items: center; gap: 10px; flex-grow: 1; }
        
        /* ×˜×•×œ×˜×™×¤ */
        .info-bubble {
            width: 24px; height: 24px; background: rgba(0, 240, 255, 0.1);
            border: 1px solid var(--accent); border-radius: 50%;
            color: var(--accent); display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 14px; cursor: pointer;
        }
        .tooltip-box { display: none; width: 100%; background: #111827; padding: 15px; border-radius: 12px; font-size: 13px; color: var(--text-dim); margin-top: -5px; margin-bottom: 15px; border: 1px solid var(--accent); line-height: 1.5; text-align: right; }

        /* ×”×•×“×¢×ª ×›×©×œ AI ××™×•×©×¨×ª ×œ×©×××œ */
        .ai-fail-box { display: none; width: 100%; justify-content: flex-start; padding: 10px; background: rgba(255, 59, 59, 0.1); border-radius: 8px; margin-bottom: 20px; align-items: center; gap: 10px; color: var(--danger); font-weight: 700; font-size: 13px; box-sizing: border-box; }

        #loader { display: none; position: fixed; inset: 0; background: var(--bg-deep); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .orbit { width: 40px; height: 40px; border: 2px solid var(--accent-glow); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

<div id="loader"><div class="orbit"></div></div>

<div id="screen-input" class="container">
    <header><h1>CarCheck <span>AI PRO</span></h1></header>
    <div class="plate-box"><div class="plate-inner"><input id="plate" class="plate-input" type="tel" placeholder="00000000" maxlength="8"></div></div>
    
    <button class="btn-main" style="background: #1f2937; margin-bottom: 35px;" onclick="window.superSearch()">ğŸ” ××™×ª×•×¨ ×××©×œ×ª×™ ××”×™×¨</button>

    <div class="field-group">
        <label>×™×¦×¨×Ÿ</label>
        <div id="brand-trigger" class="selector-trigger" onclick="window.handlePicker('brand')">×‘×—×¨ ×™×¦×¨×Ÿ...</div>
        <div id="brand-popup" class="popup-grid"><div id="brand-grid" class="grid-layout"></div></div>
    </div>

    <div class="field-group">
        <label>×“×’×</label>
        <div id="model-trigger" class="selector-trigger" onclick="window.handlePicker('model')">×‘×—×¨ ×“×’×...</div>
        <div id="model-popup" class="popup-grid"><div id="model-grid" class="grid-layout"></div></div>
    </div>

    <div class="field-group">
        <label>×©× ×”</label>
        <div id="year-trigger" class="selector-trigger" onclick="window.handlePicker('year')">×‘×—×¨ ×©× ×”...</div>
        <div id="year-popup" class="popup-grid">
            <div style="display:flex; justify-content:space-between; margin-bottom:12px; color:var(--accent); font-weight:800;">
                <span onclick="event.stopPropagation(); window.shiftY(-1)" style="cursor:pointer; padding:0 10px;">â®</span>
                <span id="y-range-text"></span>
                <span onclick="event.stopPropagation(); window.shiftY(1)" style="cursor:pointer; padding:0 10px;">â¯</span>
            </div>
            <div id="year-grid" class="grid-layout"></div>
        </div>
    </div>

    <input type="hidden" id="val-b"><input type="hidden" id="val-m"><input type="hidden" id="val-y">
    
    <button class="btn-main" onclick="window.startAI()">ğŸš€ ×”×ª×—×œ ×—×§×™×¨×ª AI</button>
    <button class="btn-main" style="background: transparent; border: 1px solid var(--border); margin-top: 15px; color: var(--text-dim);" onclick="window.goToChecklist(false)">ğŸ“ ×“×œ×’ ×œ×‘×“×™×§×” ×™×“× ×™×ª</button>
    
    <div id="ai-panel" class="ai-panel"></div>
</div>

<div id="screen-check" class="container">
    <header>
        <div class="brand-logo-container">
            <img id="brand-logo" class="brand-logo-img" src="" alt="Logo" style="display:none;">
        </div>
        <div id="ai-fail-row" class="ai-fail-box"><span>âš ï¸</span><span>× ×›×©×œ ×—×™×‘×•×¨ AI - ××¦×‘ ×‘×“×™×§×” ×™×“× ×™×ª</span></div>
    </header>
    <div id="checklist-content" style="width: 100%;"></div>
    <button class="btn-main" style="margin-top: 50px; background: var(--success); color: #000;" onclick="window.showFinalResult()">ğŸ“Š ×¡×™×•× ×•×—×©×‘ ×¦×™×•×Ÿ</button>
    <button class="btn-main" style="background: transparent; border: 1px solid var(--border); margin-top: 15px; color: var(--text-dim);" onclick="location.reload()">×—×–×•×¨</button>
</div>

<div id="screen-result" class="container" style="display:none">
    <header><h1>×¦×™×•×Ÿ <span>×¡×•×¤×™</span></h1></header>
    <div id="final-gauge" style="width:150px; height:150px; border-radius:50%; border:8px solid var(--success); display:flex; align-items:center; justify-content:center; font-size:50px; font-weight:900; color:var(--success); margin:30px 0;">0</div>
    <div id="result-text" style="text-align:center; font-size:18px; margin-bottom:20px;"></div>
    <button class="btn-main" onclick="location.reload()">×‘×“×™×§×” ×—×“×©×”</button>
</div>

<script>
// × ×ª×•× ×™×
const db = { 
    "×××•×“×™": ["A3", "A4", "Q3", "Q5"], "×‘.×.×•×•": ["×¡×“×¨×” 3", "X1", "X3", "X5"], 
    "×˜×•×™×•×˜×”": ["×§×•×¨×•×œ×”", "RAV4", "×™××¨×™×¡", "C-HR"], "×™×•× ×“××™": ["×˜×•×¡×•×Ÿ", "××™×•× ×™×§", "i20", "i10"], 
    "×××–×“×”": ["3", "6", "CX-3", "CX-5", "CX-30"], "×¡×•×‘××¨×•": ["XV", "×¤×•×¨×¡×˜×¨", "B4"], 
    "×¤×•×¨×“": ["×¤×•×§×•×¡", "×§×•×’×”", "××§×¡×¤×œ×•×¨×¨"], "×§×™×”": ["×¤×™×§× ×˜×•", "× ×™×¨×•", "×¡×¤×•×¨×˜××–'", "×¡×˜×•× ×™×§"], 
    "×©×‘×¨×•×œ×˜": ["×¡×¤××¨×§", "××§×•×•×™× ×•×§×¡", "×˜×¨××•×•×¨×¡"], "×¡×•×–×•×§×™": ["×¡×•×•×™×¤×˜", "×•×™×˜××¨×”", "×’'×™×× ×™"] 
};

// ××™×¤×•×™ ×œ×•×’×•××™× ×œ×× ×’×œ×™×ª ×¢×‘×•×¨ URL
const brandMap = {
    "×××–×“×”": "mazda", "×˜×•×™×•×˜×”": "toyota", "×™×•× ×“××™": "hyundai", "×§×™×”": "kia", 
    "×©×‘×¨×•×œ×˜": "chevrolet", "×¡×•×‘××¨×•": "subaru", "×¤×•×¨×“": "ford", "×¡×•×–×•×§×™": "suzuki", 
    "×××•×“×™": "audi", "×‘.×.×•×•": "bmw"
};

// ×‘×“×™×§×•×ª ××•×¨×—×‘×•×ª
const checklistItems = {
    "×× ×•×¢ ×•× ×•×–×œ×™×": [
        { name: "×¤×ª×— ××™×œ×•×™ ×©××Ÿ ('×˜×—×™× ×”')", tip: "×¤×ª×— ××ª ×”×¤×§×§ ×”×¦×”×•×‘. ××©×§×¢ ×œ×‘×Ÿ? ×‘×¨×—!" },
        { name: "×‘×•×¢×•×ª ×‘××™×›×œ ×¢×™×‘×•×™", tip: "×‘×–××Ÿ ×× ×•×¢ ×¢×•×‘×“ - ×‘×•×¢×•×ª ×‘××™× = ×¨××© ×× ×•×¢ ×’××•×¨." },
        { name: "××“×™×“ ×©××Ÿ (××¤×œ×¡ ×•×¦×‘×¢)", tip: "×©××Ÿ ×©×—×•×¨ ×××•×“ ××• ×—×¡×¨? ×”×–× ×—×” ×§×©×”." },
        { name: "× ×–×™×œ×•×ª ×©××Ÿ ×˜×¨×™×•×ª", tip: "×¤× ×¡ ×œ×‘×œ×•×§ ×”×× ×•×¢. ×¨×˜×™×‘×•×ª? ×ª×§×œ×”." },
        { name: "×¨×™×— ×“×œ×§ ×—×¨×™×£", tip: "×¨×™×— ×“×œ×§ ×¡×‘×™×‘ ×”×¨×›×‘ ××¢×™×“ ×¢×œ × ×–×™×œ×” ××¡×•×›× ×ª." },
        { name: "×¨×¢×© ×× ×•×¢ (×ª×§×ª×•×§×™×)", tip: "×¨×¢×© ××ª×›×ª×™ ×‘×˜×•×¨×™× × ××•×›×™×? ×‘×¢×™×”." }
    ],
    "×’×™×¨ ×•×©×œ×“×”": [
        { name: "×©×™×œ×•×‘ ×”×™×œ×•×š (××›×”)", tip: "××›×” ×‘××¢×‘×¨ ×œ-R ××• D? ×”×’×™×¨ ×¢×™×™×£." },
        { name: "×”×—×œ×§×” ×‘× ×¡×™×¢×”", tip: "×’×– × ×•×ª×Ÿ ×¨×¢×© ××‘×œ ×”×¨×›×‘ ×œ× ×××™×¥? ×”×’×™×¨ ××—×œ×™×§." },
        { name: "×§×œ×™×§×™× ×‘×¦×™×¨×™×•×ª", tip: "×¡×™×‘×•×‘ ×”×’×” ××œ× ×‘× ×¡×™×¢×” - ×¨×¢×© '×§×œ×™×§'? ×¦×™×¨×™×” ×’××•×¨×”." },
        { name: "××‘×—×Ÿ ××’× ×˜ (×¤×—×—×™×)", tip: "××’× ×˜ × ×•×¤×œ ××”×›× ×£? ×™×© ×©× ×˜×•× ×•×ª ×©×œ ×©×¤×›×˜×œ." },
        { name: "×ª××¨×™×š ×¦××™×’×™×", tip: "××¢×œ 4 ×©× ×™×? ×”×¦××™×’ ×™×‘×© ×•××¡×•×›×Ÿ." }
    ],
    "××¨×›×‘ ×•×‘×˜×™×—×•×ª (×—×“×©)": [
        { name: "×¡×“×§×™× ×‘×©××©×•×ª", tip: "×—×¤×© ×¡×“×§×™× ×§×˜× ×™× ×‘×©××©×” ×”×§×“××™×ª." },
        { name: "×’×•××™×•×ª ×“×œ×ª×•×ª ×§×¨×•×¢×•×ª", tip: "×’×•××™ ×™×‘×© ×’×•×¨× ×œ×¨×¢×©×™ ×¨×•×— ×•×›× ×™×¡×ª ××™×." },
        { name: "×—×’×•×¨×•×ª ×‘×˜×™×—×•×ª", tip: "××©×•×š ×—×–×§ - ×—×™×™×‘ ×œ×”×™× ×¢×œ ××™×“." },
        { name: "×‘×œ××™ ×’×•××™×•×ª ×“×•×•×©×•×ª", tip: "×“×•×•×©×•×ª ×©×—×•×§×•×ª ×××•×“ ×‘×¨×›×‘ '×—×“×©'? ×–×™×™×¤×• ×§×™×œ×•××˜×¨××–'." },
        { name: "×¨×˜×™×‘×•×ª ××ª×—×ª ×œ×©×˜×™×—×™×", tip: "×”×¨× ×©×˜×™×—. ×¨×˜×•×‘? × ×–×™×œ×ª ××–×’×Ÿ ××• ×—×“×™×¨×ª ×’×©×." }
    ],
    "×—×©××œ": [
        { name: "××–×’×Ÿ (×§×™×¨×•×¨ ×•×—×™××•×)", tip: "×—×™××•× ×œ× ×¢×•×‘×“? ×ª×™×§×•×Ÿ ×™×§×¨ ×××•×“." },
        { name: "×—×œ×•× ×•×ª ×•× ×¢×™×œ×”", tip: "×”×›×œ ×—×™×™×‘ ×œ×¢×‘×•×“ ×—×œ×§." },
        { name: "×§×•×¨×•×–×™×” ×‘××¦×‘×¨", tip: "××‘×§×” ×œ×‘× ×” ×¢×œ ×”×§×˜×‘×™×? ×”××¦×‘×¨ ×‘×¡×•×£ ×—×™×™×•." },
        { name: "× ×•×¨×ª ×× ×•×¢ (Check Engine)", tip: "×“×•×œ×§×ª ×§×‘×•×¢? ×™×© ×ª×§×œ×” ×¤×¢×™×œ×”." }
    ]
};

let yBase = 2018;

// ×¤×•× ×§×¦×™×•×ª ×’×œ×•×‘×œ×™×•×ª ×œ-Window (×—×•×‘×” ×‘-OneCompiler)
window.handlePicker = function(type) {
    const popups = document.querySelectorAll('.popup-grid');
    const triggers = document.querySelectorAll('.selector-trigger');
    const target = document.getElementById(type + '-popup');
    const isOpen = target.classList.contains('active');

    popups.forEach(p => p.classList.remove('active'));
    triggers.forEach(t => t.classList.remove('active'));

    if (!isOpen) {
        target.classList.add('active');
        document.getElementById(type + '-trigger').classList.add('active');
        if(type === 'brand') renderBrands();
        if(type === 'year') renderYears();
        if(type === 'model') {
            const b = document.getElementById('val-b').value;
            if(b) renderModels(b); else alert("×‘×—×¨ ×™×¦×¨×Ÿ ×§×•×“×");
        }
    }
};

function renderBrands() {
    const g = document.getElementById('brand-grid'); g.innerHTML = '';
    Object.keys(db).sort().forEach(b => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = b;
        d.onclick = (e) => { e.stopPropagation(); document.getElementById('val-b').value = b; document.getElementById('brand-trigger').innerText = b; closeAll(); };
        g.appendChild(d);
    });
}

function renderModels(b) {
    const g = document.getElementById('model-grid'); g.innerHTML = '';
    db[b].forEach(m => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = m;
        d.onclick = (e) => { e.stopPropagation(); document.getElementById('val-m').value = m; document.getElementById('model-trigger').innerText = m; closeAll(); };
        g.appendChild(d);
    });
}

function renderYears() {
    const g = document.getElementById('year-grid'); g.innerHTML = '';
    document.getElementById('y-range-text').innerText = `${yBase}-${yBase+8}`;
    for(let i=0; i<9; i++) {
        const y = yBase + i;
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = y;
        d.onclick = (e) => { e.stopPropagation(); document.getElementById('val-y').value = y; document.getElementById('year-trigger').innerText = y; closeAll(); };
        g.appendChild(d);
    }
}

window.shiftY = function(n) { yBase += (n * 9); renderYears(); };
function closeAll() { document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active')); document.querySelectorAll('.selector-trigger').forEach(t => t.classList.remove('active')); }

// ---------------------------------------------------------------------------
// ×”×ª×™×§×•×Ÿ ×”×§×¨×™×˜×™: ×—×™×‘×•×¨ ×××™×ª×™ ×œ×©×¨×ª!
// ---------------------------------------------------------------------------
window.startAI = async function() {
    const b = document.getElementById('val-b').value;
    const m = document.getElementById('val-m').value;
    const y = document.getElementById('val-y').value;

    if(!b || !m || !y) return alert("×‘×—×¨ ×¨×›×‘ ××œ×");
    
    document.getElementById('loader').style.display = 'flex';
    
    try {
        // ×©×œ×™×—×ª ×‘×§×©×” ×××™×ª×™×ª ×œ×©×¨×ª ×‘-Render
        const res = await fetch('/analyze-ai', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ brand: b, model: m, year: y })
        });

        // ×‘×“×™×§×” ×× ×”×©×¨×ª ×¢× ×” ×‘×”×¦×œ×—×” (×¡×˜×˜×•×¡ 200)
        if (!res.ok) throw new Error("Server Error");

        const data = await res.json();
        
        if(data.success) {
            const ai = data.aiAnalysis;
            const p = document.getElementById('ai-panel');
            p.style.display = 'block';
            
            // ×‘× ×™×™×ª ×¤×× ×œ ×”×ª×•×¦××•×ª ××”-AI
            p.innerHTML = `
                <div class="ai-card">
                    <h3>×¦×™×•×Ÿ ×××™× ×•×ª AI</h3>
                    <div style="font-size:35px; font-weight:900; color:var(--accent)">${ai.reliability_score}</div>
                    <p style="font-size:14px; color:var(--text-dim); margin-top:10px;">${ai.summary}</p>
                    
                    <div style="margin-top:15px; text-align:right;">
                        <div style="font-size:12px; font-weight:bold; color:var(--danger);">âš ï¸ ×ª×§×œ×•×ª × ×¤×•×¦×•×ª:</div>
                        <ul style="font-size:12px; color:var(--text-dim); padding-right:20px; margin-top:5px;">
                            ${ai.common_faults.map(f => `<li>${f}</li>`).join('')}
                        </ul>
                    </div>

                    <button class="btn-main" onclick="window.goToChecklist(false)" style="background:var(--accent); color:#000; margin-top:20px;">ğŸ“ ×”××©×š ×œ×‘×“×™×§×” ×¤×™×–×™×ª</button>
                </div>
            `;
            // ×’×œ×™×œ×” ×—×œ×§×” ×œ×ª×•×¦××”
            p.scrollIntoView({ behavior: 'smooth' });
        } else {
            throw new Error("AI Logic Failed");
        }

    } catch(e) { 
        console.error("AI Error:", e);
        // ×× × ×›×©×œ - ×—×›×” ×©× ×™×™×” ×•××– ×¢×‘×•×¨ ×œ×‘×“×™×§×” ×™×“× ×™×ª ×¢× ×”×•×“×¢×ª ×©×’×™××”
        setTimeout(() => {
            document.getElementById('loader').style.display = 'none';
            window.goToChecklist(true); 
        }, 1000);
    } finally { 
        document.getElementById('loader').style.display = 'none'; 
    }
};

window.goToChecklist = function(aiFailed) {
    const b = document.getElementById('val-b').value || "×¨×›×‘"; 
    document.getElementById('screen-input').style.display = 'none';
    document.getElementById('screen-check').style.display = 'flex';
    
    // ×œ×•×’×™×§×” ×œ×”×¦×’×ª ×œ×•×’×•
    const logoEl = document.getElementById('brand-logo');
    const englishName = brandMap[b];
    if (englishName) {
        logoEl.src = `https://logo.clearbit.com/${englishName}.com`;
        logoEl.style.display = 'block';
    } else {
        logoEl.style.display = 'none';
    }

    if(aiFailed) document.getElementById('ai-fail-row').style.display = 'flex';

    const content = document.getElementById('checklist-content'); content.innerHTML = '';
    for(let cat in checklistItems) {
        content.innerHTML += `<div class="category-header"><span class="category-title">${cat}</span><div class="category-line"></div></div>`;
        checklistItems[cat].forEach((item, index) => {
            const uid = Math.random().toString(36).substr(2, 9);
            content.innerHTML += `
                <div class="check-item" onclick="window.toggleCB('${uid}')">
                    <div class="item-text-wrapper">
                        <div class="info-bubble" onclick="event.stopPropagation(); window.toggleTip('${uid}')">!</div>
                        <span style="font-size:15px; font-weight:600;">${item.name}</span>
                    </div>
                    <div id="cb_${uid}" class="cb-custom"></div>
                </div>
                <div id="tip_${uid}" class="tooltip-box">${item.tip}</div>
            `;
        });
    }
    window.scrollTo(0,0);
};

window.toggleTip = function(id) { 
    const t = document.getElementById('tip_'+id); 
    t.style.display = (t.style.display === 'block') ? 'none' : 'block'; 
};

window.toggleCB = function(id) { 
    document.getElementById('cb_'+id).classList.toggle('checked'); 
};

window.showFinalResult = function() {
    const total = document.querySelectorAll('.cb-custom').length;
    const fails = document.querySelectorAll('.cb-custom.checked').length;
    const score = Math.max(0, 100 - Math.round((fails/total)*100));
    
    document.getElementById('screen-check').style.display = 'none';
    document.getElementById('screen-result').style.display = 'flex';
    document.getElementById('final-gauge').innerText = score;
    
    const txt = document.getElementById('result-text');
    if(score > 85) { txt.innerText = "×¨×›×‘ ××•××œ×¥ ×××•×“ âœ…"; txt.style.color = "var(--success)"; }
    else if(score > 60) { txt.innerText = "××¦×‘ ×¡×‘×™×¨ - ×œ×‘×“×•×§ ×‘××•×¡×š âš ï¸"; txt.style.color = "#ffb800"; }
    else { txt.innerText = "×œ× ××•××œ×¥ ×œ×§× ×™×™×” âŒ"; txt.style.color = "var(--danger)"; }
};

window.superSearch = function() { alert("×¤×•× ×§×¦×™×” ×–×• ×“×•×¨×©×ª ×©×¨×ª ×¤×¢×™×œ"); };

// ×¡×’×™×¨×ª ×¤×•×¤××¤×™× ×‘×œ×—×™×¦×” ×‘×—×•×¥
document.addEventListener('click', (e) => {
    if(!e.target.closest('.field-group')) {
        document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.selector-trigger').forEach(t => t.classList.remove('active'));
    }
});
</script>
</body>
</html>
