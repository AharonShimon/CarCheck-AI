<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCheck AI Pro | Expert Investigation</title>
    <style>
        :root { 
            --bg-deep: #080a0f;
            --bg-glass: rgba(23, 28, 41, 0.9);
            --accent: #00f0ff;
            --accent-glow: rgba(0, 240, 255, 0.3);
            --border: rgba(42, 59, 85, 0.7);
            --text-bright: #ffffff;
            --text-dim: #94a3b8;
            --gradient: linear-gradient(135deg, #00f0ff 0%, #007aff 100%);
            --danger: #ff3b3b;
            --success: #00ff94;
        }

        body { 
            font-family: 'Inter', 'Segoe UI', sans-serif; 
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 0%, #1a253a 0%, var(--bg-deep) 80%);
            color: var(--text-bright); margin: 0; direction: rtl; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { padding: 30px 20px; width: 100%; max-width: 450px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; }

        header { text-align: center; margin-bottom: 35px; width: 100%; }
        header h1 { font-size: 26px; font-weight: 900; letter-spacing: 2px; margin: 0; text-transform: uppercase; }
        header h1 span { color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }

        /* ×œ×•×—×™×ª ×¨×™×©×•×™ */
        .plate-box { background: #ffc400; padding: 4px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 30px; width: 100%; max-width: 320px; }
        .plate-inner { border: 2px solid #000; border-radius: 7px; display: flex; align-items: center; padding: 6px; }
        .plate-input { background: none; border: none; font-size: 38px; font-weight: 900; width: 100%; text-align: center; outline: none; letter-spacing: 4px; font-family: monospace; color: #000; }

        /* ×©×“×•×ª ×‘×—×™×¨×” */
        .field-group { margin-bottom: 22px; position: relative; width: 100%; display: flex; flex-direction: column; align-items: center; }
        label { font-size: 11px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 8px; text-align: center; width: 100%; }
        
        .selector-trigger {
            width: 100%; padding: 18px 20px; background: var(--bg-glass);
            backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 16px;
            color: #fff; font-size: 16px; cursor: pointer; display: flex; justify-content: center; align-items: center; position: relative;
            transition: 0.3s;
        }
        .selector-trigger:after { content: 'â–¼'; font-size: 10px; color: var(--accent); position: absolute; left: 20px; }
        .selector-trigger.active { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

        .popup-grid {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #111827; border: 1px solid var(--accent); border-radius: 16px;
            padding: 15px; z-index: 1000; margin-top: 8px; box-shadow: 0 20px 50px rgba(0,0,0,0.9);
            max-height: 350px; overflow-y: auto;
        }
        .popup-grid.active { display: block; animation: slideUp 0.25s ease; }

        .grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
        .grid-item { padding: 12px 5px; text-align: center; background: #1f2937; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; color: #d1d5db; border: 1px solid transparent; }
        .grid-item:hover { border-color: var(--accent); color: var(--accent); }

        .btn-main {
            width: 100%; padding: 18px; border-radius: 12px; border: none;
            font-size: 17px; font-weight: 800; cursor: pointer; color: white;
            background: var(--gradient); box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3); margin-top: 10px; text-align: center;
        }

        /* ×¦'×§ ×œ×™×¡×˜ */
        #screen-check { display: none; width: 100%; flex-direction: column; align-items: center; }
        
        .brand-logo-img { height: 60px; width: auto; display: block; margin: 0 auto 15px auto; filter: drop-shadow(0 0 10px var(--accent-glow)); }
        
        .category-header { 
            width: 100%; margin: 45px 0 20px 0; text-align: center;
        }
        .category-title { 
            color: var(--text-bright); font-size: 22px; font-weight: 800; 
            letter-spacing: 1px; display: block; margin-bottom: 8px;
        }
        .category-line { width: 80px; height: 3px; background: var(--gradient); margin: 0 auto; border-radius: 2px; }

        .check-item { 
            width: 100%; background: var(--bg-glass); padding: 20px; border-radius: 16px; 
            margin-bottom: 12px; border: 1px solid var(--border); display: flex; 
            justify-content: space-between; align-items: center; box-sizing: border-box;
        }

        .cb-custom { width: 28px; height: 28px; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; transition: 0.3s; flex-shrink: 0; }
        .cb-custom.checked { background: var(--danger); border-color: var(--danger); display: flex; align-items: center; justify-content: center; }
        .cb-custom.checked:after { content: 'âœ•'; color: white; font-weight: 900; }
        
        .item-content { display: flex; align-items: center; gap: 12px; flex-grow: 1; }
        
        /* Tooltip Style */
        .info-circle {
            width: 26px; height: 26px; background: rgba(255, 59, 59, 0.1);
            border: 2px solid var(--danger); border-radius: 50%;
            color: var(--danger); display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 15px; cursor: pointer;
        }
        .tooltip-box { display: none; width: 100%; background: #111827; padding: 15px; border-radius: 12px; font-size: 14px; color: var(--text-dim); margin-top: -8px; margin-bottom: 15px; border: 1px solid var(--danger); line-height: 1.6; text-align: right; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }

        .ai-status-row { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; }
        .ai-fail-tag { color: var(--danger); font-size: 13px; font-weight: 800; text-transform: uppercase; }

        #loader { display: none; position: fixed; inset: 0; background: var(--bg-deep); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .orbit { width: 40px; height: 40px; border: 2px solid var(--accent-glow); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

<div id="loader"><div class="orbit"></div></div>

<div id="screen-input" class="container">
    <header><h1>CarCheck <span>AI PRO</span></h1></header>
    <div class="plate-box"><div class="plate-inner"><input id="plate" class="plate-input" type="tel" placeholder="00000000" maxlength="8"></div></div>
    
    <button class="btn-main" style="background: #1f2937; margin-bottom: 35px;" onclick="superSearch()">ğŸ” ××™×ª×•×¨ ×××©×œ×ª×™ ××”×™×¨</button>

    <div class="field-group">
        <label>×™×¦×¨×Ÿ</label>
        <div id="brand-trigger" class="selector-trigger" onclick="handlePicker('brand')">×‘×—×¨ ×™×¦×¨×Ÿ...</div>
        <div id="brand-popup" class="popup-grid"><div id="brand-grid" class="grid-layout"></div></div>
    </div>

    <div class="field-group">
        <label>×“×’×</label>
        <div id="model-trigger" class="selector-trigger" onclick="handlePicker('model')">×‘×—×¨ ×“×’×...</div>
        <div id="model-popup" class="popup-grid"><div id="model-grid" class="grid-layout"></div></div>
    </div>

    <div class="field-group">
        <label>×©× ×”</label>
        <div id="year-trigger" class="selector-trigger" onclick="handlePicker('year')">×‘×—×¨ ×©× ×”...</div>
        <div id="year-popup" class="popup-grid">
            <div style="display:flex; justify-content:space-between; margin-bottom:12px; color:var(--accent); font-weight:800;">
                <span onclick="event.stopPropagation(); shiftY(-1)" style="cursor:pointer; padding:0 10px;">â®</span>
                <span id="y-range-text"></span>
                <span onclick="event.stopPropagation(); shiftY(1)" style="cursor:pointer; padding:0 10px;">â¯</span>
            </div>
            <div id="year-grid" class="grid-layout"></div>
        </div>
    </div>

    <input type="hidden" id="val-b"><input type="hidden" id="val-m"><input type="hidden" id="val-y">
    <button class="btn-main" onclick="startAI()">ğŸš€ ×”×ª×—×œ ×—×§×™×¨×ª AI</button>
    <button class="btn-main" style="background: transparent; border: 1px solid var(--border); margin-top: 15px; color: var(--text-dim);" onclick="goToChecklist(false)">ğŸ“ ×“×œ×’ ×œ×‘×“×™×§×” ×™×“× ×™×ª</button>
    <div id="ai-panel" class="ai-panel" style="width:100%;"></div>
</div>

<div id="screen-check" class="container">
    <header>
        <img id="brand-logo" class="brand-logo-img" src="" alt="" style="display:none;">
        <div class="ai-status-row">
            <h1 id="check-car-name" style="font-size: 24px; margin: 0;">×‘×“×™×§×ª ×¨×›×‘</h1>
            <span id="ai-fail-label" class="ai-fail-tag" style="display:none;">âš ï¸ × ×›×©×œ AI</span>
        </div>
    </header>
    <div id="checklist-content" style="width: 100%;"></div>
    <button class="btn-main" style="margin-top: 50px; background: var(--success); color: #000;" onclick="alert('×—×™×©×•×‘ ×¦×™×•×Ÿ...')">ğŸ“Š ×¡×™×•× ×•×—×©×‘ ×¦×™×•×Ÿ</button>
</div>

<script>
const db = { 
    "×××•×“×™": ["A3", "A4", "Q3", "Q5"], 
    "×‘.×.×•×•": ["×¡×“×¨×” 3", "X1", "X3", "X5"], 
    "×˜×•×™×•×˜×”": ["×§×•×¨×•×œ×”", "RAV4", "×™××¨×™×¡"], 
    "×™×•× ×“××™": ["×˜×•×¡×•×Ÿ", "××™×•× ×™×§", "i20"], 
    "×××–×“×”": ["3", "6", "CX-3", "CX-5", "CX-30"], 
    "×¡×•×‘××¨×•": ["XV", "×¤×•×¨×¡×˜×¨"], 
    "×¤×•×¨×“": ["×¤×•×§×•×¡", "×§×•×’×”", "××§×¡×¤×œ×•×¨×¨"], 
    "×§×™×”": ["×¤×™×§× ×˜×•", "× ×™×¨×•", "×¡×¤×•×¨×˜××–'"], 
    "×©×‘×¨×•×œ×˜": ["×¡×¤××¨×§", "××§×•×•×™× ×•×§×¡", "×˜×¨××•×•×¨×¡"], 
    "×¡×•×–×•×§×™": ["×¡×•×•×™×¤×˜", "×•×™×˜××¨×”"] 
};

const brandLogos = { "×××–×“×”": "mazda", "×˜×•×™×•×˜×”": "toyota", "×™×•× ×“××™": "hyundai", "×§×™×”": "kia", "×©×‘×¨×•×œ×˜": "chevrolet", "×¡×•×‘××¨×•": "subaru", "×¤×•×¨×“": "ford", "×¡×•×–×•×§×™": "suzuki", "×××•×“×™": "audi", "×‘.×.×•×•": "bmw" };

const checklistItems = {
    "×× ×•×¢ ×•× ×•×–×œ×™×": [
        { name: "×¤×ª×— ××™×œ×•×™ ×©××Ÿ ('×˜×—×™× ×”')", tip: "×—×¤×© ××©×§×¢ ×œ×‘×Ÿ/××¤×•×¨. ×× ×™×© - ×–×” ××¢×™×“ ×¢×œ ×¢×¨×‘×•×‘ ××™× ×•×©××Ÿ (×¨××© ×× ×•×¢ ×¤×’×•×)." },
        { name: "× ×•×–×œ ×§×™×¨×•×¨ (×‘×•×¢×•×ª/×—×œ×•×“×”)", tip: "×‘×× ×•×¢ ×§×¨: ×•×•×“× × ×•×–×œ × ×§×™. ×‘×•×¢×•×ª ××•×•×™×¨ ×‘×–××Ÿ ×¢×‘×•×“×” ××¢×™×“×•×ª ×¢×œ ×‘×¨×™×—×ª ×§×•××¤×¨×¡×™×”." },
        { name: "×¨×™×— ×“×œ×§ ×—×¨×™×£", tip: "×‘×“×•×§ ×¡×‘×™×‘ ×”×× ×•×¢. ×¨×™×— ×—×–×§ ××¢×™×“ ×¢×œ ×“×œ×™×¤×” ×‘××©××‘×” ××• ×‘×¦×™× ×•×¨×•×ª (× ×¤×•×¥ ×‘×¡×•×•×™×¤×˜ 2010)." },
        { name: "× ×–×™×œ×•×ª ×’×œ×•×™×•×ª", tip: "×¡×¨×•×§ ×¢× ×¤× ×¡ ××ª ×ª×—×ª×™×ª ×”×× ×•×¢. ×©××Ÿ ×˜×¨×™ ×¢×œ ×”×‘×œ×•×§ ×”×•× × ×•×¨×ª ××–×”×¨×”." },
        { name: "×¨×¢×© ×©×¨×©×¨×ª/×¨×¦×•×¢×”", tip: "×‘×”×ª× ×¢×” ×§×¨×”: ×—×¤×© ×¨×¢×© ××ª×›×ª×™ ×©× ×¢×œ× ××—×¨×™ ×“×§×”. ×–×” ××¢×™×“ ×¢×œ ××•×ª×—×Ÿ ×©×—×•×§." }
    ],
    "×’×™×¨ ×•×©×œ×“×”": [
        { name: "×©×™×œ×•×‘ ×”×™×œ×•×š (××›×”)", tip: "×”×¢×‘×¨ ×‘×™×Ÿ P ×œ-R. ×”××¢×‘×¨ ×—×™×™×‘ ×œ×”×™×•×ª ×—×œ×§. ××›×” ×—×–×§×” ××¢×™×“×” ×¢×œ ×‘×œ××™ ×‘×’×™×¨." },
        { name: "××‘×—×Ÿ ××’× ×˜ (×¤×—×—×™×)", tip: "×”×¢×‘×¨ ××’× ×˜ ×¢×œ ×”×›× ×¤×™×™×. ×× ×œ× × ×“×‘×§ - ×™×© ×©× ×—×•××¨ ××™×œ×•×™ ×¢×‘×” ××—×¨×™ ×ª××•× ×”." },
        { name: "×‘×¨×’×™ ×›× ×¤×™×™×", tip: "×—×¤×© ×§×™×œ×•×¤×™ ×¦×‘×¢ ×¢×œ ×”×‘×¨×’×™× ×©××—×–×™×§×™× ××ª ×”×¤×—. ×§×™×œ×•×£ = ×¤×•×¨×§×• ×œ×ª×™×§×•×Ÿ ×ª××•× ×”." },
        { name: "×ª××¨×™×š ×¦××™×’×™×", tip: "×•×•×“× ×©-4 ×”×¡×¤×¨×•×ª (×œ××©×œ 1223) ××¨××•×ª ×¦××™×’ ×‘×Ÿ ×¤×—×•×ª ×-4 ×©× ×™×." }
    ],
    "×—×©××œ": [
        { name: "××–×’×Ÿ - ×§×™×¨×•×¨ ×•×—×™××•×", tip: "×‘×“×•×§ ××ª ×©× ×™ ×”××¦×‘×™×. ×¨×“×™××˜×•×¨ ×—×™××•× ×¤× ×™××™ × ×•×˜×” ×œ×”×™×¡×ª× ×•×ª×™×§×•× ×• ×™×§×¨." },
        { name: "× ×•×¨×•×ª ××–×”×¨×” (OBD)", tip: "×•×•×“× ×©×›×œ ×”× ×•×¨×•×ª × ×›×‘×•×ª. × ×•×¨×” ×›×ª×•××” ×¢×œ×•×œ×” ×œ×”×¢×™×“ ×¢×œ ×§×•×“ P0171 (×ª×¢×¨×•×‘×ª ×¢× ×™×™×”)." }
    ]
};

let yBase = 2018;

// ×¤×•× ×§×¦×™×™×ª ×¤×ª×™×—×ª ×¤×•×¤-××¤ - ×’×¨×¡×ª OneCompiler ×—×¡×™× ×”
function handlePicker(type) {
    const popups = document.querySelectorAll('.popup-grid');
    const triggers = document.querySelectorAll('.selector-trigger');
    const target = document.getElementById(type + '-popup');
    const isOpen = target.classList.contains('active');

    popups.forEach(p => p.classList.remove('active'));
    triggers.forEach(t => t.classList.remove('active'));

    if (!isOpen) {
        target.classList.add('active');
        document.getElementById(type + '-trigger').classList.add('active');
        if(type === 'brand') rBrands();
        if(type === 'year') rYears();
        if(type === 'model') {
            const b = document.getElementById('val-b').value;
            if(b) rModels(b); else alert("×‘×—×¨ ×™×¦×¨×Ÿ ×§×•×“×");
        }
    }
}

function rBrands() {
    const g = document.getElementById('brand-grid'); g.innerHTML = '';
    Object.keys(db).sort().forEach(b => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = b;
        d.onclick = (e) => { e.stopPropagation(); document.getElementById('val-b').value = b; document.getElementById('brand-trigger').innerText = b; closeAll(); };
        g.appendChild(d);
    });
}

function rModels(b) {
    const g = document.getElementById('model-grid'); g.innerHTML = '';
    db[b].forEach(m => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = m;
        d.onclick = (e) => { e.stopPropagation(); document.getElementById('val-m').value = m; document.getElementById('model-trigger').innerText = m; closeAll(); };
        g.appendChild(d);
    });
}

function rYears() {
    const g = document.getElementById('year-grid'); g.innerHTML = '';
    document.getElementById('y-range-text').innerText = `${yBase}-${yBase+8}`;
    for(let i=0; i<9; i++) {
        const y = yBase + i;
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = y;
        d.onclick = (e) => { e.stopPropagation(); document.getElementById('val-y').value = y; document.getElementById('year-trigger').innerText = y; closeAll(); };
        g.appendChild(d);
    }
}

function shiftY(n) { yBase += (n * 9); rYears(); }
function closeAll() { document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active')); document.querySelectorAll('.selector-trigger').forEach(t => t.classList.remove('active')); }

async function startAI() {
    const b = document.getElementById('val-b').value, m = document.getElementById('val-m').value, y = document.getElementById('val-y').value;
    if(!b || !m || !y) return alert("×‘×—×¨ ×¨×›×‘ ××œ×");
    document.getElementById('loader').style.display = 'flex';
    try {
        const res = await fetch('/analyze-ai', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({brand: b, model: m, year: y}) });
        const data = await res.json();
        if(data.success) {
            const ai = data.aiAnalysis;
            const p = document.getElementById('ai-panel'); p.style.display = 'block';
            p.innerHTML = `<div class="ai-card"><h3>×¦×™×•×Ÿ AI</h3><div style="font-size:35px;font-weight:900;color:var(--accent)">${ai.reliability_score}</div></div><button class="btn-main" onclick="goToChecklist(false)" style="background:var(--accent);color:#000;">ğŸ“ ×¢×‘×•×¨ ×œ×‘×“×™×§×” ×¤×™×–×™×ª</button>`;
        } else throw new Error();
    } catch(e) { goToChecklist(true); } finally { document.getElementById('loader').style.display = 'none'; }
}

function goToChecklist(aiFailed) {
    const b = document.getElementById('val-b').value || "×¨×›×‘";
    const m = document.getElementById('val-m').value || "";
    document.getElementById('screen-input').style.display = 'none';
    document.getElementById('screen-check').style.display = 'flex';
    document.getElementById('check-car-name').innerText = `${b} ${m}`;
    
    if(aiFailed) document.getElementById('ai-fail-label').style.display = 'inline';
    
    const logo = document.getElementById('brand-logo');
    if(brandLogos[b]) { logo.src = `https://logo.clearbit.com/${brandLogos[b]}.com`; logo.style.display = 'block'; }

    const content = document.getElementById('checklist-content'); content.innerHTML = '';
    let i = 0;
    for(let cat in checklistItems) {
        content.innerHTML += `<div class="category-header"><span class="category-title">${cat}</span><div class="category-line"></div></div>`;
        checklistItems[cat].forEach(item => {
            i++;
            content.innerHTML += `
                <div class="check-item" onclick="toggleCB(${i})">
                    <div class="item-content">
                        <div class="info-circle" onclick="event.stopPropagation(); toggleTip(${i})">!</div>
                        <span style="font-size:15px; font-weight:600;">${item.name}</span>
                    </div>
                    <div id="cb_${i}" class="cb-custom"></div>
                </div>
                <div id="tip_${i}" class="tooltip-box">${item.tip}</div>
            `;
        });
    }
}

function toggleTip(id) { const t = document.getElementById('tip_'+id); t.style.display = (t.style.display === 'block') ? 'none' : 'block'; }
function toggleCB(id) { document.getElementById('cb_'+id).classList.toggle('checked'); }

async function superSearch() { /* ×œ×•×’×™×§×” ×××©×œ×ª×™×ª */ }
</script>
</body>
</html>
