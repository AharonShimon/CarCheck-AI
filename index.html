<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCheck AI Pro | Ultimate Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-deep: #0b0e14;
            --bg-card: #131b26;
            --accent: #00f0ff;
            --accent-glow: rgba(0, 240, 255, 0.35);
            --border: #1f2937;
            --text-bright: #ffffff;
            --text-dim: #94a3b8;
            --gradient: linear-gradient(135deg, #00f0ff 0%, #007aff 100%);
            --danger: #ff3b3b;
            --success: #00ff94;
            --info-icon: #0ea5e9;
        }

        body { 
            font-family: 'Heebo', sans-serif; 
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 0%, #1a253a 0%, var(--bg-deep) 85%);
            color: var(--text-bright); margin: 0; direction: rtl; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }

        .container { padding: 20px; width: 100%; max-width: 450px; box-sizing: border-box; padding-bottom: 90px; }

        header { text-align: center; margin-bottom: 25px; }
        header h1 { font-size: 28px; font-weight: 900; margin: 0; text-transform: uppercase; letter-spacing: 1px; }
        header h1 span { color: var(--accent); text-shadow: 0 0 15px var(--accent-glow); }

        .plate-box { background: #ffc400; padding: 6px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); margin: 0 auto 30px auto; width: 100%; max-width: 320px; }
        .plate-inner { border: 3px solid #000; border-radius: 8px; display: flex; align-items: center; padding: 5px; }
        .plate-input { background: none; border: none; font-size: 42px; font-weight: 900; width: 100%; text-align: center; outline: none; letter-spacing: 5px; font-family: monospace; color: #000; }

        .field-group { margin-bottom: 18px; width: 100%; position: relative; }
        label { font-size: 14px; font-weight: 700; color: var(--accent); margin-bottom: 8px; display: block; text-align: right; }
        
        .selector-trigger { width: 100%; height: 55px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; color: #fff; font-size: 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-sizing: border-box; transition: 0.2s; }
        .selector-trigger span { color: var(--accent); }

        .popup-grid { display: none; position: absolute; top: 100%; left: 0; right: 0; background: #111827; border: 1px solid var(--accent); border-radius: 12px; padding: 15px; z-index: 9999; margin-top: 5px; box-shadow: 0 20px 50px rgba(0,0,0,0.9); max-height: 350px; overflow-y: auto; }
        .popup-grid.active { display: block; animation: slideUp 0.2s ease-out; }

        .search-input { width: 100%; padding: 12px; margin-bottom: 12px; background: #000; border: 1px solid var(--border); border-radius: 8px; color: white; font-size: 16px; text-align: right; outline: none; }
        .grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .grid-item { padding: 10px 5px; text-align: center; background: #1f2937; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; color: #e2e8f0; border: 1px solid transparent; min-height: 40px; display: flex; align-items: center; justify-content: center; line-height: 1.2; word-break: break-word; }
        .grid-item:hover { background: var(--accent); color: #000; }

        .btn-main { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 18px; font-weight: 800; cursor: pointer; color: white; background: var(--gradient); box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3); margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-outline { background: transparent; border: 1px solid var(--border); margin-top: 15px; color: var(--text-dim); width: 100%; padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; }

        #screen-check { display: none; width: 100%; flex-direction: column; align-items: center; }
        .category-header { width: 100%; margin: 25px 0 10px 0; text-align: center; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
        .category-title { color: var(--accent); font-size: 18px; font-weight: 800; }

        .check-item { width: 100%; background: var(--bg-card); border-radius: 12px; margin-bottom: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; box-sizing: border-box; transition: 0.2s; }
        .check-item-header { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 15px; box-sizing: border-box; }
        .right-side { display: flex; align-items: center; gap: 12px; flex-grow: 1; justify-content: flex-start; }
        
        .info-btn { width: 24px; height: 24px; border-radius: 50%; border: 1px solid var(--info-icon); color: var(--info-icon); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; cursor: pointer; flex-shrink: 0; }
        .item-name { font-weight: 600; font-size: 15px; color: #e2e8f0; text-align: right; }
        
        .cb-custom { width: 28px; height: 28px; border: 2px solid #374151; border-radius: 6px; cursor: pointer; background: transparent; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .cb-custom.bad { background: var(--danger); border-color: var(--danger); }
        .cb-custom.bad:after { content: 'âœ•'; color: white; font-weight: 900; font-size: 18px; }

        .how-to-box { display: none; background: rgba(17, 24, 39, 0.9); border-top: 1px solid var(--border); padding: 15px; font-size: 14px; color: #94a3b8; line-height: 1.5; text-align: right; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }
        .ok-text { color: var(--success); display: block; margin-top: 5px; font-weight: bold; }

        #screen-result { display: none; flex-direction: column; align-items: center; text-align: center; width: 100%; }
        .result-container { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .final-gauge { width: 150px; height: 150px; border-radius: 50%; border: 10px solid var(--success); display: flex; align-items: center; justify-content: center; font-size: 60px; font-weight: 900; margin: 20px 0; color: #fff; text-shadow: 0 0 20px var(--success); box-shadow: 0 0 30px rgba(0, 255, 148, 0.2); }
        
        #loader { display: none; position: fixed; inset: 0; background: var(--bg-deep); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .orbit { width: 50px; height: 50px; border: 3px solid var(--accent); border-top-color: transparent; border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    </style>
</head>
<body>

<div id="loader"><div class="orbit"></div><div style="margin-top:15px; color:var(--accent);">××¢×‘×“ × ×ª×•× ×™×...</div></div>

<div id="screen-input" class="container">
    <header><h1>CARCHECK <span>AI ULTIMATE</span></h1></header>
    <div class="plate-box"><div class="plate-inner"><input id="plate" class="plate-input" type="tel" placeholder="00000000" maxlength="8"></div></div>
    
    <div class="field-group">
        <label>×™×¦×¨×Ÿ ×¨×›×‘</label>
        <div id="brand-trigger" class="selector-trigger" onclick="window.handlePicker('brand')"><span>×‘×—×¨ ×™×¦×¨×Ÿ...</span> <span>â–¼</span></div>
        <div id="brand-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×™×¦×¨×Ÿ..." onkeyup="window.filterGrid('brand', this.value)">
            <div id="brand-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-b">
    </div>

    <div class="field-group">
        <label>×“×’×</label>
        <div id="model-trigger" class="selector-trigger" onclick="window.handlePicker('model')"><span>×‘×—×¨ ×“×’×...</span> <span>â–¼</span></div>
        <div id="model-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×“×’×..." onkeyup="window.filterGrid('model', this.value)">
            <div id="model-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-m">
    </div>

    <div class="field-group">
        <label>×©× ×ª ×™×™×¦×•×¨</label>
        <div id="year-trigger" class="selector-trigger" onclick="window.handlePicker('year')"><span>×‘×—×¨ ×©× ×”...</span> <span>â–¼</span></div>
        <div id="year-popup" class="popup-grid">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; padding:0 10px; font-weight:bold; color:var(--accent);">
                <span onclick="event.stopPropagation(); window.shiftY(-1)">â®</span>
                <span id="y-range-text"></span>
                <span onclick="event.stopPropagation(); window.shiftY(1)">â¯</span>
            </div>
            <div id="year-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-y">
    </div>
    
    <button class="btn-main" onclick="window.startAI()">ğŸš€ × ×™×ª×•×— ××—×œ×•×ª AI</button>
    <button class="btn-main btn-outline" onclick="window.goToChecklist()">ğŸ“ ×“×œ×’ ×œ×‘×“×™×§×ª ×©×˜×—</button>
    <div id="ai-panel" style="margin-top: 30px;"></div>
</div>

<div id="screen-check" class="container">
    <header><h1>×‘×“×™×§×ª <span>×©×˜×—</span></h1></header>
    <div id="checklist-content" style="width: 100%;"></div>
    <div style="position:fixed; bottom:0; left:0; right:0; background:var(--bg-deep); padding:15px 20px; border-top:1px solid var(--border); z-index:100;">
        <button class="btn-main" style="background: var(--success); color: #000; margin:0;" onclick="window.finishCheck()">ğŸ“Š ×¡×™×™× ×•×—×©×‘ ×¦×™×•×Ÿ</button>
    </div>
</div>

<div id="screen-result" class="container">
    <div class="result-container">
        <header><h1>×ª×•×¦××ª <span>×‘×“×™×§×”</span></h1></header>
        <div id="final-gauge" class="final-gauge">100</div>
        <div id="result-text" style="font-size:20px; margin-bottom:20px; font-weight:700;">×¨×›×‘ ×‘××¦×‘ ××¢×•×œ×”!</div>
        <button class="btn-main" style="background:#05C3DE; width:100%;" onclick="window.findGarage()">ğŸ“ × ×•×•×˜ ×œ××›×•×Ÿ ×‘×“×™×§×” (Waze)</button>
        <button class="btn-main btn-outline" style="width:100%;" onclick="location.reload()">ğŸ”„ ×‘×“×™×§×” ×—×“×©×”</button>
    </div>
</div>

<script>
const carDatabase = {
    "×˜×•×™×•×˜×”": ["×§×•×¨×•×œ×”", "×™××¨×™×¡", "RAV4", "C-HR", "×œ× ×“ ×§×¨×•×–×¨", "×¤×¨×™×•×¡", "×”×™×™×œ×§×¡", "×§×××¨×™", "××™×™×’×• X"],
    "×™×•× ×“××™": ["i10", "i20", "i30", "××™×•× ×™×§ 5", "××™×•× ×™×§ 6", "×˜×•×¡×•×Ÿ", "×¡× ×˜×” ×¤×”", "×§×•× ×”", "××œ× ×˜×¨×”", "×‘××™×•×Ÿ", "×•×œ×•×¡×˜×¨", "i25"],
    "×§×™×”": ["×¤×™×§× ×˜×•", "×¡×¤×•×¨×˜××–'", "× ×™×¨×•", "×¡×˜×•× ×™×§", "×¡×•×¨× ×˜×•", "×§×¨× ×™×‘×œ", "EV6", "×¨×™×•", "×¡×™×“"],
    "×××–×“×”": ["2", "3", "6", "CX-3", "CX-5", "CX-30", "CX-60", "CX-9", "MX-5"],
    "×¡×•×‘××¨×•": ["XV", "×¤×•×¨×¡×˜×¨", "×××•×˜×‘×§", "××™××¤×¨×–×”", "B4", "×§×¨×•×¡×˜×¨×§", "STI", "BRZ"],
    "×¡×•×–×•×§×™": ["×¡×•×•×™×¤×˜", "×•×™×˜××¨×”", "×’'×™×× ×™", "×§×¨×•×¡××•×‘×¨", "×‘××œ× ×•", "××™×’× ×™×¡", "××œ×˜×•"],
    "×¡×§×•×“×”": ["××•×§×˜×‘×™×”", "×¡×•×¤×¨×‘", "×§×•×“×™××§", "×§××¨×•×§", "×§×××™×§", "×¤××‘×™×”"],
    "×¤×•×œ×§×¡×•×•×’×Ÿ": ["×’×•×œ×£", "×¤×•×œ×•", "×˜×™×’×•××Ÿ", "×¤××¡××˜", "ID.4", "T-Roc", "×˜×•×¨××Ÿ"],
    "××¨×¦×“×¡": ["A-Class", "C-Class", "E-Class", "S-Class", "GLA", "GLC", "GLE"],
    "×‘.×.×•×•": ["×¡×“×¨×” 1", "×¡×“×¨×” 3", "×¡×“×¨×” 5", "X1", "X3", "X5"],
    "×××•×“×™": ["A1", "A3", "A4", "A6", "Q3", "Q5", "Q7"],
    "×©×‘×¨×•×œ×˜": ["×¡×¤××¨×§", "×˜×¨××•×•×¨×¡", "××§×•×•×™× ×•×§×¡", "×‘×œ×™×™×–×¨", "×¡×™×œ×‘×¨×“×•"],
    "×¡×™××˜": ["××™×‘×™×–×”", "×œ××•×Ÿ", "××¨×•× ×”", "××˜×§×”"],
    "BYD": ["Atto 3", "Dolphin", "Seal", "Tang"],
    "MG": ["MG4", "ZS EV", "EHS", "Marvel R"],
    "×œ×§×¡×•×¡": ["NX", "RX", "UX", "ES", "IS"],
    "×’'× ×¡×™×¡": ["G70", "G80", "GV60", "GV70", "GV80"]
};

// === ×¨×©×™××ª 35 ×‘×“×™×§×•×ª ××œ××” ===
const checklistData = [
    {
        category: "×× ×•×¢ ×•××¢×¨×›×ª ×§×™×¨×•×¨ (×§×¨×™×˜×™)",
        items: [
            { name: "×¤×ª×— ××™×œ×•×™ ×©××Ÿ ('×˜×—×™× ×”')", weight: 25, howTo: "×¤×ª×— ××ª ×”×¤×§×§. ×§×¦×£ ×œ×‘×Ÿ/×—×•× = ××™× ×‘×©××Ÿ (×¨××© ×× ×•×¢).", ok: "×¤×§×§ × ×§×™ ××©××Ÿ ×©×¨×•×£ ××• ×§×¦×£." },
            { name: "×‘×•×¢×•×ª ×‘××™×›×œ ×¢×™×‘×•×™", weight: 25, howTo: "×›×©×”×× ×•×¢ ×¤×•×¢×œ, ×”×× ×¢×•×œ×•×ª ×‘×•×¢×•×ª ×‘××™×›×œ ×”××™×?", ok: "××™× ×©×§×˜×™× ×œ×œ× ×‘×•×¢×•×ª ××•×•×™×¨." },
            { name: "× ×©×™××ª ×× ×•×¢ (Blow-By)", weight: 25, howTo: "×”× ×— ×¤×§×§ ×©××Ÿ ×”×¤×•×š ×›×©×”×× ×•×¢ ×¤×•×¢×œ. ×”×× ×”×•× ×¢×£?", ok: "×”×¤×§×§ ×¨×•×¢×“ ×§×œ×•×ª ×‘××§×•× ×•×œ× ×¢×£." },
            { name: "×¨×™×— ×“×œ×§ ×—×¨×™×£", weight: 25, howTo: "×”×¨×— ×¡×‘×™×‘ ×”×× ×•×¢ ×•×‘×ª×•×š ×”×¨×›×‘ (××•×©×‘ ××—×•×¨×™).", ok: "××™×Ÿ ×¨×™×— ×“×œ×§." },
            { name: "×‘×•×¥ ×©××Ÿ (Sludge)", weight: 20, howTo: "×”××¨ ×¢× ×¤× ×¡ ×œ×ª×•×š ×¤×ª×— ××™×œ×•×™ ×”×©××Ÿ. ××©×§×¢ ×©×—×•×¨?", ok: "×—×œ×§×™ ×”××ª×›×ª ×‘×¤× ×™× × ×¨××™× × ×§×™×™×." },
            { name: "××“×™×“ ×©××Ÿ (××¤×œ×¡ ×•×¦×‘×¢)", weight: 15, howTo: "×‘×“×•×§ ×©××Ÿ. ×©×—×•×¨ ××“×™? ×—×•×¡×¨ ×©××Ÿ?", ok: "×©××Ÿ ×‘×’×•×•×Ÿ ×“×‘×©/×—×•×, ×‘××¤×œ×¡ ×”× ×›×•×Ÿ." },
            { name: "× ×–×™×œ×•×ª ×©××Ÿ ×˜×¨×™×•×ª", weight: 15, howTo: "×”×¡×ª×›×œ ××ª×—×ª ×œ×¨×›×‘ ×•×¢×œ ×”×‘×œ×•×§. ×¨×˜×™×‘×•×ª?", ok: "×× ×•×¢ ×™×‘×© ×•××‘×§×ª×™." },
            { name: "×¦×‘×¢ × ×•×–×œ ×§×™×¨×•×¨", weight: 10, howTo: "××™× ×—×•××™×? ×—×œ×•×“×”?", ok: "× ×•×–×œ ×‘×¦×‘×¢ ××§×•×¨×™ (×•×¨×•×“/×™×¨×•×§) ×•×¦×œ×•×œ." },
            { name: "×¨×¢×© ×× ×•×¢ (×ª×§×ª×•×§×™×)", weight: 15, howTo: "×”×§×©×‘ ×œ×× ×•×¢ ×‘×¡×¨×§. ×¨×¢×© ××ª×›×ª×™?", ok: "×¢×‘×•×“×” ×¢×’×•×œ×” ×•×©×§×˜×”." },
            { name: "×œ×—×¥ ×‘×¦× ×¨×ª ×¨×“×™××˜×•×¨", weight: 15, howTo: "×›×©×”×× ×•×¢ ×—×, ×œ×—×¥ ×¢×œ ×”×¦×™× ×•×¨ ×”×¢×œ×™×•×Ÿ. ×§×©×” ×›××‘×Ÿ?", ok: "×”×¦×™× ×•×¨ ×—× ×•×’××™×© ××¢×˜ ×‘×œ×—×™×¦×”." },
            { name: "×××•×•×¨×¨ ×¨×“×™××˜×•×¨", weight: 15, howTo: "×”×¤×¢×œ ××–×’×Ÿ. ×”×× ×”×××•×•×¨×¨ × ×›× ×¡ ×œ×¤×¢×•×œ×”?", ok: "×”×××•×•×¨×¨ ×¢×•×‘×“ ×—×–×§ ××™×“." }
        ]
    },
    {
        category: "×’×™×¨ ×•×”× ×¢×”",
        items: [
            { name: "××›×” ×‘×©×™×œ×•×‘ ×”×™×œ×•×š", weight: 15, howTo: "×”×¢×‘×¨ P ×œ-D. ×™×© ×“×¤×™×§×”?", ok: "×©×™×œ×•×‘ ×—×œ×§." },
            { name: "×”×—×œ×§×” ×‘×”××¦×”", weight: 20, howTo: "×ª×Ÿ ×’×–. ×”×˜×•×¨×™× ×¢×•×œ×™× ×•×”×¨×›×‘ ×œ× ×–×–?", ok: "×ª××•×¦×” ××™×™×“×™×ª." },
            { name: "×¨×¢×™×“×•×ª ×‘× ×¡×™×¢×”", weight: 15, howTo: "×¨×¢×™×“×•×ª ×‘×”×’×” ×‘-100 ×§×\"×©?", ok: "× ×¡×™×¢×” ×—×œ×§×”." },
            { name: "×¨×¢×©×™ ×¦×™×¨×™×•×ª (×§×œ×™×§×™×)", weight: 15, howTo: "×¡×™×‘×•×‘ ××œ× ×‘× ×¡×™×¢×” ××™×˜×™×ª. ×¨×¢×© ×ª×§×ª×•×§?", ok: "×©×§×˜ ××•×—×œ×˜ ×‘×¡×™×‘×•×‘." },
            { name: "××¦×‘ ×©××Ÿ ×’×™×¨", weight: 10, howTo: "×× ×™×© ××“×™×“ - ×©××Ÿ ×©×¨×•×£?", ok: "×©××Ÿ ××“×•×/×‘×”×™×¨ ×•× ×§×™." }
        ]
    },
    {
        category: "×©×œ×“×” ×•××¨×›×‘",
        items: [
            { name: "××‘×—×Ÿ ×”××’× ×˜ (×¤×—×—×•×ª)", weight: 15, howTo: "×”××’× ×˜ × ×•×¤×œ ××”×›× ×£? ×™×© ×©×¤×›×˜×œ.", ok: "××’× ×˜ × ×ª×¤×¡ ×—×–×§." },
            { name: "× ×§×•×“×•×ª ×¨×™×ª×•×š ×‘×’×•××™×•×ª", weight: 20, howTo: "××©×•×š ×’×•××™×•×ª ×“×œ×ª. ×™×© × ×§×•×“×•×ª ×¢×’×•×œ×•×ª?", ok: "× ×§×•×“×•×ª ××§×•×¨×™×•×ª." },
            { name: "×‘×¨×’×™ ×›× ×¤×™×™× (×¤×™×¨×•×§)", weight: 12, howTo: "×¦×‘×¢ ××ª×§×œ×£ ×¢×œ ×”×‘×¨×’×™×?", ok: "×‘×¨×’×™× ××§×•×¨×™×™× ×œ×œ× ×¡×™×× ×™ ××¤×ª×—." },
            { name: "×¨×˜×™×‘×•×ª ×‘×ª× ××˜×¢×Ÿ", weight: 15, howTo: "×”×¨× ×©×˜×™×— ×‘×‘×’××–'. ×™×© ××™×?", ok: "×™×‘×© ×•× ×§×™." },
            { name: "×”×‘×“×œ×™ ×’×•×•×Ÿ ×‘×¦×‘×¢", weight: 10, howTo: "×”×¡×ª×›×œ ×‘×©××© ×¢×œ ×”×“×œ×ª×•×ª.", ok: "×¦×‘×¢ ××—×™×“." },
            { name: "×¡×™××˜×¨×™×” ×‘××¨×•×•×—×™×", weight: 10, howTo: "×¨×•×•×—×™× ×©×•×•×™× ×‘×™×Ÿ ××›×¡×” ×× ×•×¢ ×œ×›× ×¤×™×™×?", ok: "×§×•×•×™× ×™×©×¨×™×." },
            { name: "×—×œ×•×“×” ×‘×ª×—×ª×™×ª ×”×¨×›×‘", weight: 15, howTo: "×”×ª×›×•×¤×£ ×•×”×¡×ª×›×œ ×œ××˜×”.", ok: "× ×§×™ ××—×œ×•×“×” ×¢××•×§×”." }
        ]
    },
    {
        category: "×—×©××œ ×•×¤× ×™×",
        items: [
            { name: "× ×•×¨×•×ª ××–×”×¨×” ×“×•×œ×§×•×ª", weight: 20, howTo: "×”×× × ×•×¨×ª ×× ×•×¢ ×“×•×œ×§×ª?", ok: "×œ×•×— × ×§×™ ×× ×•×¨×•×ª." },
            { name: "××–×’×Ÿ (×§×•×¨)", weight: 10, howTo: "×”×× ××§×¨×¨ ××™×“?", ok: "××§×¤×™×." },
            { name: "×—×™××•× (×¨×“×™××˜×•×¨ ×¤× ×™××™)", weight: 10, howTo: "×”×× ××•×¦×™× ×—×•×?", ok: "××—×× ×—×–×§." },
            { name: "×—×œ×•× ×•×ª ×—×©××œ", weight: 5, howTo: "×‘×“×•×§ ××ª ×›×œ ×”-4.", ok: "×¢×•×œ×™× ×•×™×•×¨×“×™× ×—×œ×§." },
            { name: "× ×¢×™×œ×” ××¨×›×–×™×ª", weight: 5, howTo: "× ×¢×œ ×•×¤×ª×— ××ª ×”×¨×›×‘.", ok: "×›×œ ×”×“×œ×ª×•×ª ××’×™×‘×•×ª." },
            { name: "××¦×‘ ×¨×™×¤×•×“×™×", weight: 5, howTo: "×§×¨×¢×™× ××• ×›×ª××™×?", ok: "×©×œ× ×•× ×§×™." },
            { name: "× ×–×§×™ ×”×¦×¤×”", weight: 20, howTo: "×—×•×œ ××ª×—×ª ×œ×©×˜×™×—?", ok: "× ×§×™ ×•×™×‘×©." }
        ]
    },
    {
        category: "×¦××™×’×™× ×•×‘×˜×™×—×•×ª",
        items: [
            { name: "×ª××¨×™×š ×¦××™×’×™×", weight: 5, howTo: "×—×¤×© 4 ×¡×¤×¨×•×ª (×œ××©×œ 1023).", ok: "×¢×“ 4 ×©× ×™× ×¢×œ ×”×›×‘×™×©." },
            { name: "×™×•×‘×© ×‘×¦××™×’×™×", weight: 5, howTo: "×¡×“×§×™× ×‘×¦×“ ×”×¦××™×’?", ok: "×’×•××™ ×˜×¨×™." },
            { name: "×’×œ×’×œ ×¨×–×¨×‘×™/×¢×¨×›×”", weight: 5, howTo: "×”×× ×§×™×™×?", ok: "× ××¦× ×•×ª×§×™×Ÿ." },
            { name: "×—×’×•×¨×•×ª ×‘×˜×™×—×•×ª", weight: 5, howTo: "××©×•×š ×—×–×§ - × × ×¢×œ?", ok: "×× ×’× ×•×Ÿ ×¢×•×‘×“." },
            { name: "×•×™×©×¨×™× ×•××ª×™×–×™×", weight: 5, howTo: "×× ×§×™× ×˜×•×‘?", ok: "×’××™×©×™× ×•×¢×•×‘×“×™×." }
        ]
    }
];

let yBase = 2018; let currentScore = 100;

window.handlePicker = function(type) {
    const target = document.getElementById(type + '-popup');
    const isOpen = target.classList.contains('active');
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
    if (!isOpen) {
        target.classList.add('active');
        if(type === 'brand') renderGrid('brand', Object.keys(carDatabase));
        if(type === 'year') renderYears();
        if(type === 'model') renderGrid('model', carDatabase[document.getElementById('val-b').value] || []);
    }
};

function renderGrid(type, items, query = "") {
    const g = document.getElementById(type + '-grid'); g.innerHTML = '';
    items.sort((a,b) => a.localeCompare(b, 'he'));
    
    // ×× ×’× ×•×Ÿ ×—×™×¤×•×© ×—×•×¤×©×™
    if (items.length === 0 && query.length > 0) {
        const d = document.createElement('div'); d.className = 'grid-item'; d.style.gridColumn = "1/-1";
        d.innerHTML = `×”×©×ª××© ×‘: "${query}"`;
        d.onclick = () => selectItem(type, query);
        g.appendChild(d);
        return;
    }

    items.forEach(item => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = item;
        d.onclick = () => selectItem(type, item);
        g.appendChild(d);
    });
}

function selectItem(type, value) {
    document.getElementById('val-' + type.charAt(0)).value = value;
    document.getElementById(type + '-trigger').innerHTML = `<span>${value}</span> <span>â–¼</span>`;
    if(type === 'brand') { document.getElementById('val-m').value = ''; document.getElementById('model-trigger').innerHTML = `<span>×‘×—×¨ ×“×’×...</span> <span>â–¼</span>`; }
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
}

window.filterGrid = function(type, query) {
    let source = type === 'brand' ? Object.keys(carDatabase) : (carDatabase[document.getElementById('val-b').value] || []);
    renderGrid(type, source.filter(i => i.toLowerCase().includes(query.toLowerCase())), query);
};

function renderYears() {
    const g = document.getElementById('year-grid'); g.innerHTML = '';
    document.getElementById('y-range-text').innerText = `${yBase}-${yBase+8}`;
    for(let i=0; i<9; i++){
        let y = yBase+i; let d = document.createElement('div'); d.className = 'grid-item'; d.innerText = y;
        d.onclick = () => selectItem('year', y);
        g.appendChild(d);
    }
}
window.shiftY = function(n) { yBase += (n * 9); renderYears(); };

window.startAI = async function() {
    const b = document.getElementById('val-b').value;
    const m = document.getElementById('val-m').value;
    const y = document.getElementById('val-y').value;
    if(!b || !m || !y) return alert("×× × ×‘×—×¨ ×¨×›×‘ ××œ×");
    document.getElementById('loader').style.display = 'flex';
    try {
        const res = await fetch('/analyze-ai', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ brand: b, model: m, year: y }) });
        const data = await res.json();
        if(data.success) {
            const ai = data.aiAnalysis;
            const p = document.getElementById('ai-panel'); p.style.display = 'block';
            p.innerHTML = `<div class="ai-card" style="background:#131b26; padding:15px; border-radius:12px; margin-top:15px; border:1px solid #1f2937;">
                <div style="font-size:36px; font-weight:900; color:var(--accent); text-align:center;">${ai.reliability_score}</div>
                <p style="text-align:center; font-size:14px;">${ai.summary}</p>
                <button class="btn-main" onclick="window.goToChecklist()" style="font-size:16px;">×”××©×š ×œ×‘×“×™×§×”</button>
            </div>`;
        }
    } catch(e) { alert("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ-AI"); }
    finally { document.getElementById('loader').style.display = 'none'; }
};

window.goToChecklist = function() {
    document.getElementById('screen-input').style.display = 'none';
    document.getElementById('screen-check').style.display = 'flex';
    const content = document.getElementById('checklist-content'); content.innerHTML = '';
    currentScore = 100;
    
    checklistData.forEach((cat, cIdx) => {
        content.innerHTML += `<div class="category-header"><span class="category-title">${cat.category}</span></div>`;
        cat.items.forEach((item, iIdx) => {
            const id = `cb-${cIdx}-${iIdx}`;
            content.innerHTML += `<div class="check-item">
                <div class="check-item-header">
                    <div class="right-side">
                        <div class="info-btn" onclick="window.toggleHow('${id}')">!</div>
                        <span class="item-name">${item.name}</span>
                    </div>
                    <div id="${id}" class="cb-custom" onclick="this.classList.toggle('bad'); window.updateScore(${item.weight}, this.classList.contains('bad'))"></div>
                </div>
                <div id="how-${id}" class="how-to-box">${item.howTo} <span class="ok-text">${item.ok}</span></div>
            </div>`;
        });
    });
    window.scrollTo(0,0);
};

window.toggleHow = (id) => { const el = document.getElementById('how-'+id); el.style.display = el.style.display === 'block' ? 'none' : 'block'; };
window.updateScore = (w, isBad) => currentScore += isBad ? -w : w;

window.finishCheck = () => {
    document.getElementById('screen-check').style.display = 'none';
    document.getElementById('screen-result').style.display = 'flex';
    const score = Math.max(0, currentScore);
    const g = document.getElementById('final-gauge');
    g.innerText = score;
    let color = score > 85 ? "var(--success)" : (score > 60 ? "var(--warning)" : "var(--danger)");
    g.style.borderColor = color; g.style.color = color;
    document.getElementById('result-text').innerText = score > 85 ? "×¨×›×‘ ×‘××¦×‘ ××¢×•×œ×”!" : (score > 60 ? "××¦×‘ ×¡×‘×™×¨." : "×œ× ××•××œ×¥.");
};

window.findGarage = () => {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => {
            window.open(`https://waze.com/ul?q=××›×•×Ÿ%20×‘×“×™×§×ª%20×¨×›×‘&ll=${p.coords.latitude},${p.coords.longitude}&navigate=yes`, '_blank');
        }, () => window.open(`https://waze.com/ul?q=××›×•×Ÿ%20×‘×“×™×§×ª%20×¨×›×‘&navigate=yes`, '_blank'));
    }
};

document.addEventListener('click', (e) => {
    if(!e.target.closest('.field-group')) {
        document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
    }
});
</script>
</body>
</html>
