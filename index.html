<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCheck AI Pro | Ultimate Edition</title>
    <style>
        :root { 
            --bg-deep: #0b0e14;
            --bg-glass: rgba(23, 28, 41, 0.95);
            --accent: #00f0ff;
            --accent-glow: rgba(0, 240, 255, 0.25);
            --border: rgba(42, 59, 85, 0.6);
            --text-bright: #ffffff;
            --text-dim: #94a3b8;
            --gradient: linear-gradient(135deg, #00f0ff 0%, #007aff 100%);
            --danger: #ff3b3b;
            --success: #00ff94;
            --warning: #f59e0b;
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 0%, #1a253a 0%, var(--bg-deep) 80%);
            color: var(--text-bright); margin: 0; direction: rtl; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { padding: 30px 20px; width: 100%; max-width: 450px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; }

        header { text-align: center; margin-bottom: 30px; width: 100%; }
        header h1 { font-size: 26px; font-weight: 900; letter-spacing: 2px; margin: 0; text-transform: uppercase; }
        header h1 span { color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }

        /* ×œ×•×—×™×ª ×¨×™×©×•×™ */
        .plate-box { background: #ffc400; padding: 4px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 30px; width: 100%; max-width: 320px; }
        .plate-inner { border: 2px solid #000; border-radius: 7px; display: flex; align-items: center; padding: 6px; }
        .plate-input { background: none; border: none; font-size: 38px; font-weight: 900; width: 100%; text-align: center; outline: none; letter-spacing: 4px; font-family: monospace; color: #000; }

        .field-group { margin-bottom: 22px; width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; }
        label { font-size: 11px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 8px; width: 100%; text-align: center; }
        
        .selector-trigger {
            width: 100%; padding: 16px 20px; background: var(--bg-glass);
            backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 14px;
            color: #fff; font-size: 16px; cursor: pointer; display: flex; justify-content: center; align-items: center; position: relative;
            transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .selector-trigger:active { transform: scale(0.98); border-color: var(--accent); }
        .selector-trigger:after { content: 'â–¼'; font-size: 10px; color: var(--accent); position: absolute; left: 20px; }

        .popup-grid {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #111827; border: 1px solid var(--accent); border-radius: 16px;
            padding: 15px; z-index: 1000; margin-top: 8px; box-shadow: 0 25px 50px rgba(0,0,0,0.9);
            max-height: 350px; overflow-y: auto;
        }
        .popup-grid.active { display: block; animation: slideUp 0.2s ease-out; }

        .search-input {
            width: 100%; padding: 12px; margin-bottom: 12px;
            background: #0b0e14; border: 1px solid var(--border); border-radius: 8px;
            color: white; font-size: 14px; box-sizing: border-box; text-align: right;
        }

        .grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
        .grid-item { 
            padding: 12px 5px; text-align: center; background: #1f2937; border-radius: 8px; 
            font-size: 13px; font-weight: 600; cursor: pointer; color: #d1d5db; border: 1px solid transparent; word-break: break-word;
        }
        .grid-item:hover { border-color: var(--accent); color: var(--accent); }

        .btn-main {
            width: 100%; padding: 18px; border-radius: 14px; border: none;
            font-size: 17px; font-weight: 800; cursor: pointer; color: white;
            background: var(--gradient); box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3); margin-top: 10px; text-align: center;
        }
        .btn-outline { background: transparent; border: 1px solid var(--border); margin-top: 15px; color: var(--text-dim); }

        /* AI Results */
        .ai-panel { margin-top: 35px; display: none; width: 100%; text-align: center; }
        .ai-card { background: var(--bg-glass); padding: 20px; border-radius: 16px; border-bottom: 4px solid var(--accent); margin-bottom: 15px; text-align: right; }
        .ai-score-big { text-align: center; font-size: 42px; font-weight: 900; color: var(--accent); margin: 10px 0; }
        .list-title { font-size: 13px; font-weight: 800; margin-top: 15px; margin-bottom: 5px; display: block; }
        .list-ul { padding-right: 20px; margin: 0; font-size: 13px; color: var(--text-dim); list-style-type: disc; }

        /* Checklist Enhanced UI */
        #screen-check { display: none; width: 100%; flex-direction: column; align-items: center; }
        .category-header { width: 100%; margin: 25px 0 10px 0; text-align: center; }
        .category-title { color: var(--accent); font-size: 16px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
        .category-line { width: 40px; height: 2px; background: var(--accent); margin: 5px auto 0 auto; box-shadow: 0 0 10px var(--accent); }

        .check-item { 
            width: 100%; background: var(--bg-glass); padding: 15px; border-radius: 12px; 
            margin-bottom: 10px; border: 1px solid var(--border); display: flex; flex-direction: column;
            box-sizing: border-box;
        }
        .check-item-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .item-text-wrapper { display: flex; align-items: center; gap: 10px; }
        .info-btn { 
            background: rgba(0, 240, 255, 0.1); color: var(--accent); border: 1px solid var(--accent);
            width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 14px; cursor: pointer; font-weight: bold;
        }
        .how-to-box {
            display: none; background: rgba(0, 122, 255, 0.1); border: 1px solid rgba(0, 122, 255, 0.3);
            padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 13px; color: #bae6fd; line-height: 1.5;
            animation: fadeIn 0.3s;
        }
        .cb-custom { width: 28px; height: 28px; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; transition: 0.3s; flex-shrink: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.2); }
        .cb-custom.bad { background: var(--danger); border-color: var(--danger); box-shadow: 0 0 10px rgba(255, 59, 59, 0.4); }
        .cb-custom.bad:after { content: 'âœ•'; color: white; font-weight: 900; }

        /* Loader & Animations */
        #loader { display: none; position: fixed; inset: 0; background: var(--bg-deep); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .orbit { width: 50px; height: 50px; border: 3px solid var(--accent-glow); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* Result Screen */
        #screen-result { display: none; text-align: center; }
        .final-gauge { 
            width: 160px; height: 160px; border-radius: 50%; border: 10px solid var(--border); 
            display: flex; align-items: center; justify-content: center; font-size: 56px; font-weight: 900; 
            margin: 30px auto; background: var(--bg-glass);
        }
    </style>
</head>
<body>

<div id="loader"><div class="orbit"></div><div style="margin-top:15px; color:var(--accent)">×× ×ª×— × ×ª×•× ×™×...</div></div>

<div id="screen-input" class="container">
    <header><h1>CarCheck <span>AI PRO</span></h1></header>
    
    <div class="plate-box"><div class="plate-inner"><input id="plate" class="plate-input" type="tel" placeholder="00000000" maxlength="8"></div></div>
    <button class="btn-main" style="background: #1f2937; margin-bottom: 35px;" onclick="alert('×—×™×‘×•×¨ ×××©×œ×ª×™ ×‘×§×¨×•×‘')">ğŸ” ××™×ª×•×¨ ×××©×œ×ª×™ ××”×™×¨</button>

    <div class="field-group">
        <label>×™×¦×¨×Ÿ</label>
        <div id="brand-trigger" class="selector-trigger" onclick="window.handlePicker('brand')">×‘×—×¨ ×™×¦×¨×Ÿ...</div>
        <div id="brand-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×™×¦×¨×Ÿ..." onkeyup="window.filterGrid('brand', this.value)">
            <div id="brand-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-b">
    </div>

    <div class="field-group">
        <label>×“×’×</label>
        <div id="model-trigger" class="selector-trigger" onclick="window.handlePicker('model')">×‘×—×¨ ×“×’×...</div>
        <div id="model-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×“×’×..." onkeyup="window.filterGrid('model', this.value)">
            <div id="model-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-m">
    </div>

    <div class="field-group">
        <label>×©× ×”</label>
        <div id="year-trigger" class="selector-trigger" onclick="window.handlePicker('year')">×‘×—×¨ ×©× ×”...</div>
        <div id="year-popup" class="popup-grid">
            <div style="display:flex; justify-content:space-between; margin-bottom:12px; color:var(--accent); font-weight:800; padding: 0 10px;">
                <span onclick="event.stopPropagation(); window.shiftY(-1)" style="cursor:pointer;">â®</span>
                <span id="y-range-text"></span>
                <span onclick="event.stopPropagation(); window.shiftY(1)" style="cursor:pointer;">â¯</span>
            </div>
            <div id="year-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-y">
    </div>
    
    <button class="btn-main" onclick="window.startAI()">ğŸš€ ×”×ª×—×œ ×—×§×™×¨×ª AI</button>
    <button class="btn-main btn-outline" onclick="window.goToChecklist()">ğŸ“ ×“×œ×’ ×œ×‘×“×™×§×” ×™×“× ×™×ª</button>
    
    <div id="ai-panel" class="ai-panel"></div>
</div>

<div id="screen-check" class="container">
    <header><h1>×‘×“×™×§×” <span>×¢×¦×××™×ª</span></h1><p style="font-size:13px; color:var(--text-dim); margin-top:-10px;">×œ×—×¥ ×¢×œ â„¹ï¸ ×œ×”×¡×‘×¨ ×‘×“×™×§×” ××¤×•×¨×˜</p></header>
    <div id="checklist-content" style="width: 100%;"></div>
    <div style="position:sticky; bottom:20px; width:100%;"><button class="btn-main" style="background: var(--success); color: #000;" onclick="window.finishCheck()">ğŸ“Š ×©×§×œ×œ ×¦×™×•×Ÿ ×¡×•×¤×™</button></div>
</div>

<div id="screen-result" class="container">
    <header><h1>×¦×™×•×Ÿ <span>××©×•×§×œ×œ</span></h1></header>
    <div id="final-gauge" class="final-gauge">0</div>
    <div id="result-text" style="text-align:center; font-size:18px; margin-bottom:30px; line-height:1.5;"></div>
    <button class="btn-main" style="background: #4285F4;" onclick="window.findGarage()">ğŸ“ ××¦× ××›×•×Ÿ ×‘×“×™×§×” ×§×¨×•×‘</button>
    <button class="btn-main btn-outline" onclick="location.reload()">×‘×“×™×§×” ×—×“×©×”</button>
</div>

<script>
// === ×××’×¨ ×¨×›×‘×™× ×¢× ×§ (×œ× ×—×¡×›×ª×™ ×‘×›×œ×•×!) ===
const carDatabase = {
    "×˜×•×™×•×˜×”": ["×§×•×¨×•×œ×”", "×™××¨×™×¡", "RAV4", "C-HR", "×œ× ×“ ×§×¨×•×–×¨", "×¤×¨×™×•×¡", "×”×™×™×œ×§×¡", "×§×××¨×™", "××™×™×’×• X", "bZ4X", "×§×•×¨×•×œ×” ×§×¨×•×¡", "×™××¨×™×¡ ×§×¨×•×¡"],
    "×™×•× ×“××™": ["i10", "i20", "i30", "××™×•× ×™×§ 5", "××™×•× ×™×§ 6", "×˜×•×¡×•×Ÿ", "×¡× ×˜×” ×¤×”", "×§×•× ×”", "××œ× ×˜×¨×”", "×‘××™×•×Ÿ", "×•×œ×•×¡×˜×¨", "i25"],
    "×§×™×”": ["×¤×™×§× ×˜×•", "×¡×¤×•×¨×˜××–'", "× ×™×¨×•", "×¡×˜×•× ×™×§", "×¡×•×¨× ×˜×•", "×§×¨× ×™×‘×œ", "EV6", "×¨×™×•", "×¡×™×“", "××•×¤×˜×™××”", "×¡×œ×˜×•×¡"],
    "×××–×“×”": ["2", "3", "6", "CX-3", "CX-5", "CX-30", "CX-60", "CX-9", "MX-5"],
    "×¡×§×•×“×”": ["××•×§×˜×‘×™×”", "×¡×•×¤×¨×‘", "×§×•×“×™××§", "×§××¨×•×§", "×§×××™×§", "×¤××‘×™×”", "×¡×§××œ×”", "×× ×™×™××§", "×™×™×˜×™"],
    "×¡×•×‘××¨×•": ["XV", "×¤×•×¨×¡×˜×¨", "×××•×˜×‘×§", "××™××¤×¨×–×”", "B4", "×§×¨×•×¡×˜×¨×§", "BRZ", "Evoltis", "STI"],
    "×¤×•×œ×§×¡×•×•×’×Ÿ": ["×’×•×œ×£", "×¤×•×œ×•", "×˜×™×’×•××Ÿ", "×¤××¡××˜", "ID.4", "T-Roc", "×˜×•×¨××Ÿ", "×’'×˜×”", "××¨×˜××•×Ÿ"],
    "×××•×“×™": ["A1", "A3", "A4", "A6", "Q2", "Q3", "Q5", "Q7", "Q8", "e-tron"],
    "××¨×¦×“×¡": ["A-Class", "C-Class", "E-Class", "S-Class", "GLA", "GLC", "GLE", "EQE", "EQS", "CLA"],
    "×‘.×.×•×•": ["×¡×“×¨×” 1", "×¡×“×¨×” 2", "×¡×“×¨×” 3", "×¡×“×¨×” 4", "×¡×“×¨×” 5", "×¡×“×¨×” 7", "X1", "X2", "X3", "X4", "X5", "X6"],
    "×©×‘×¨×•×œ×˜": ["×¡×¤××¨×§", "×˜×¨××•×•×¨×¡", "××§×•×•×™× ×•×§×¡", "×‘×œ×™×™×–×¨", "×§×•×œ×•×¨×“×•", "×¡×™×œ×‘×¨×“×•", "×××œ×™×‘×•"],
    "×¡×•×–×•×§×™": ["×¡×•×•×™×¤×˜", "×•×™×˜××¨×”", "×’'×™×× ×™", "××™×’× ×™×¡", "×§×¨×•×¡××•×‘×¨", "×‘××œ× ×•", "××œ×˜×•", "×¡×œ×¨×™×•"],
    "××™×¦×•×‘×™×©×™": ["×××•×˜×œ× ×“×¨", "××§×œ×™×¤×¡ ×§×¨×•×¡", "ASX", "×¡×¤×™×™×¡ ×¡×˜××¨", "××˜×¨××–'", "×œ×× ×¡×¨", "×¤××’'×¨×•"],
    "×¤×•×¨×“": ["×¤×•×§×•×¡", "×§×•×’×”", "××§×¡×¤×œ×•×¨×¨", "×‘×¨×•× ×§×•", "××•×¡×˜× ×’", "×¨×™×™× ×’'×¨", "×¤×™××¡×˜×”", "××“×’'"],
    "×¡×™××˜": ["××™×‘×™×–×”", "×œ××•×Ÿ", "××¨×•× ×”", "××˜×§×”", "×˜×¨××§×•"],
    "×¤×™×’'×•": ["208", "3008", "5008", "2008", "308", "508"],
    "×¨× ×•": ["×§×œ×™××•", "××’××Ÿ", "×§×¤×¦'×•×¨", "××¨×§× ×”", "××•×¡×˜×¨×œ", "×§×“×’'××¨", "×§× ×’×•"],
    "×¡×™×˜×¨×•××Ÿ": ["C3", "C4", "C5 Aircross", "×‘×¨×œ×™× ×’×•", "C3 ××™×™×¨×§×¨×•×¡"],
    "×˜×¡×œ×”": ["Model 3", "Model Y", "Model S", "Model X"],
    "BYD": ["Atto 3", "Dolphin", "Seal", "Tang", "Han"],
    "MG": ["MG4", "MG5", "ZS EV", "EHS", "Marvel R"],
    "×’'×™×œ×™": ["Geometry C"],
    "×¦'×¨×™": ["FX", "Tiggo 7", "Tiggo 8"],
    "×œ×§×¡×•×¡": ["NX", "RX", "UX", "ES", "IS", "LS"],
    "×’'× ×¡×™×¡": ["G70", "G80", "GV60", "GV70", "GV80"],
    "×§×•×¤×¨×”": ["×¤×•×¨×× ×˜×•×¨", "×œ××•×Ÿ", "××˜×§×”", "×‘×•×¨×Ÿ"]
};

// === ×¦'×§ ×œ×™×¡×˜ ××©×•×§×œ×œ ×•××•×¨×—×‘ (×”×›×œ ×‘×¤× ×™×!) ===
const checklistData = [
    {
        category: "×× ×•×¢ (×§×¨×™×˜×™ - 25 × ×§' ×œ×™×—×™×“×”)",
        items: [
            { name: "×‘×“×™×§×ª '×˜×—×™× ×”' ×‘×©××Ÿ", weight: 25, howTo: "×¤×ª×—×• ××ª ×¤×§×§ ××™×œ×•×™ ×”×©××Ÿ. ×—×¤×©×• ×§×¦×£ ×œ×‘×Ÿ/×—×•× (×›××• ××™×•× ×–). ×–×” ××¢×™×“ ×¢×œ ×¢×¨×‘×•×‘ ××™× ×•×©××Ÿ - ×¨××© ×× ×•×¢ ×’××•×¨." },
            { name: "×‘×•×¢×•×ª ×‘××™×›×œ ×¢×™×‘×•×™", weight: 25, howTo: "×›×©×”×× ×•×¢ ×¤×•×¢×œ (×œ× ×›×©×”×•× ×¨×•×ª×—!), ×”×¡×ª×›×œ×• ×‘××™×›×œ ×”××™×. ×‘×•×¢×•×ª ×§×‘×•×¢×•×ª = ×‘×¨×™×—×ª ×§×•××¤×¨×¡×™×” ××”×‘×•×›× ×•×ª." },
            { name: "× ×–×™×œ×•×ª ×©××Ÿ/××™× ×˜×¨×™×•×ª", weight: 15, howTo: "×”×©×ª××©×• ×‘×¤× ×¡. ×—×¤×©×• ×¨×˜×™×‘×•×ª ×©×—×•×¨×” × ×•×¦×¦×ª ××ª×—×ª ×œ×× ×•×¢. ×× ×•×¢ × ×§×™ ××“×™? ××•×œ×™ ×©×˜×¤×• ××•×ª×• ×›×“×™ ×œ×”×¡×ª×™×¨ × ×–×™×œ×”." },
            { name: "×¢×©×Ÿ ××”××’×–×•×– (××›×ª ×’×–)", weight: 20, howTo: "×ª× ×• ×’×– ×—×–×§. ×¢×©×Ÿ ×›×—×•×œ = ×”×× ×•×¢ ×©×•×¨×£ ×©××Ÿ. ×¢×©×Ÿ ×œ×‘×Ÿ ×¡××™×š = ×—×“×™×¨×ª ××™× ×œ×× ×•×¢." }
        ]
    },
    {
        category: "×’×™×¨ ×•×”×™×œ×•×›×™× (20 × ×§' ×œ×™×—×™×“×”)",
        items: [
            { name: "××›×” ×‘×©×™×œ×•×‘ ×”×™×œ×•×š (P ×œ-D)", weight: 15, howTo: "×œ×—×¦×• ×‘×¨×§×¡ ×•×”×¢×‘×™×¨×• ×‘×™×Ÿ ×”××¦×‘×™×. ×”×× ×™×© ×“×¤×™×§×” ×—×–×§×” ××• ×§×¤×™×¦×”? ×¡×™××Ÿ ×œ×‘×œ××™ ×‘×’×™×¨ ××• ×‘×ª×•×©×‘×•×ª." },
            { name: "×”×—×œ×§×” ×‘×”××¦×” (Slipping)", weight: 20, howTo: "×‘×–××Ÿ × ×¡×™×¢×”, ×œ×—×¦×• ×—×–×§ ×¢×œ ×”×’×–. ×× ×”×˜×•×¨×™× ×¢×•×œ×™× ××”×¨ ××‘×œ ×”××”×™×¨×•×ª ×œ× ×¢×•×œ×” ×‘×”×ª×× - ×”×’×™×¨ ××—×œ×™×§." }
        ]
    },
    {
        category: "×©×œ×“×” ×•××¨×›×‘ (15 × ×§' ×œ×™×—×™×“×”)",
        items: [
            { name: "×¡×™×× ×™ ×¤×—×—×•×ª (××‘×—×Ÿ ××’× ×˜)", weight: 10, howTo: "×¢×‘×¨×• ×¢× ××’× ×˜ ×¢×œ ×”×›× ×¤×™×™× ×•×”×“×œ×ª×•×ª. ×× ×”×•× ×œ× × ×¦××“ - ×™×© ×©× ×˜×•× ×•×ª ×©×œ ×©×¤×›×˜×œ ×©××¡×ª×™×¨ ×ª××•× ×”." },
            { name: "× ×§×•×“×•×ª ×¨×™×ª×•×š ×‘×’×•××™×•×ª", weight: 15, howTo: "××©×›×• ××¢×˜ ××ª ×’×•××™×•×ª ×”×“×œ×ª×•×ª. ×—×¤×©×• ×¨×™×ª×•×›×™× ×œ× ××§×•×¨×™×™× ××• ×¡×™×× ×™ ×¦×‘×¢ ×œ× ××—×™×“×™×." }
        ]
    },
    {
        category: "×—×©××œ ×•×¤× ×™× (10 × ×§' ×œ×™×—×™×“×”)",
        items: [
            { name: "××–×’×Ÿ (×§×•×¨ ×•×—×•×)", weight: 10, howTo: "×‘×“×§×• ×©×”××–×’×Ÿ ××§×¤×™× ×ª×•×š ×“×§×”. ×”×¢×‘×™×¨×• ×œ×—×™××•× - ×× ×œ× ×¢×•×‘×“, ×™×™×ª×›×Ÿ ×©×¨×“×™××˜×•×¨ ×”×—×™××•× ×¡×ª×•× (×ª×™×§×•×Ÿ ×™×§×¨)." },
            { name: "× ×•×¨×•×ª ××–×”×¨×” ×“×•×œ×§×•×ª", weight: 15, howTo: "×”× ×™×¢×• ××ª ×”×¨×›×‘. × ×•×¨×ª ×× ×•×¢, ×’×™×¨ ××• ×›×¨×™×ª ××•×•×™×¨ ×“×•×œ×§×ª? ×–×• ×ª×§×œ×” ×©×¨×©×•××” ×‘××—×©×‘ ×”×¨×›×‘." }
        ]
    },
    {
        category: "×¦××™×’×™× ×•×‘×˜×™×—×•×ª (5 × ×§' ×œ×™×—×™×“×”)",
        items: [
            { name: "×ª××¨×™×š ×•×™×•×‘×© ×¦××™×’×™×", weight: 5, howTo: "×—×¤×©×• 4 ×¡×¤×¨×•×ª (×œ××©×œ 1222 = ×©×‘×•×¢ 12 ×©× ×ª 2022). ×¦××™×’ ××¢×œ 4 ×©× ×™× ×”×•× ×™×‘×© ×•××¡×•×›×Ÿ." }
        ]
    }
];

let yBase = 2018; let currentScore = 100;

window.handlePicker = function(type) {
    const target = document.getElementById(type + '-popup');
    const isOpen = target.classList.contains('active');
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
    if (!isOpen) {
        target.classList.add('active');
        if(type === 'brand') renderGrid('brand', Object.keys(carDatabase));
        if(type === 'year') renderYears();
        if(type === 'model') renderGrid('model', carDatabase[document.getElementById('val-b').value] || []);
    }
};

function renderGrid(type, items, query = "") {
    const g = document.getElementById(type + '-grid'); g.innerHTML = '';
    items.sort((a,b) => a.localeCompare(b, 'he'));

    if (items.length === 0 && query.length > 0) {
        const d = document.createElement('div'); d.className = 'grid-item'; d.style.gridColumn = "1/-1";
        d.innerHTML = `×©×™××•×© ×‘-"${query}" ğŸ”`;
        d.onclick = () => selectItem(type, query);
        g.appendChild(d);
        return;
    }

    items.forEach(item => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = item;
        d.onclick = () => selectItem(type, item);
        g.appendChild(d);
    });
}

function selectItem(type, value) {
    document.getElementById('val-' + type.charAt(0)).value = value;
    document.getElementById(type + '-trigger').innerText = value;
    if(type === 'brand') { document.getElementById('val-m').value = ''; document.getElementById('model-trigger').innerText = '×‘×—×¨ ×“×’×...'; }
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
}

window.filterGrid = function(type, query) {
    let source = type === 'brand' ? Object.keys(carDatabase) : (carDatabase[document.getElementById('val-b').value] || []);
    renderGrid(type, source.filter(i => i.toLowerCase().includes(query.toLowerCase())), query);
};

function renderYears() {
    const g = document.getElementById('year-grid'); g.innerHTML = '';
    document.getElementById('y-range-text').innerText = `${yBase}-${yBase+8}`;
    for(let i=0; i<9; i++){
        let y = yBase+i; let d = document.createElement('div'); d.className = 'grid-item'; d.innerText = y;
        d.onclick = () => { document.getElementById('val-y').value = y; document.getElementById('year-trigger').innerText = y; document.getElementById('year-popup').classList.remove('active'); };
        g.appendChild(d);
    }
}
window.shiftY = function(n) { yBase += (n * 9); renderYears(); };

window.startAI = async function() {
    const b = document.getElementById('val-b').value;
    const m = document.getElementById('val-m').value;
    const y = document.getElementById('val-y').value;
    if(!b || !m || !y) return alert("×× × ×‘×—×¨ ×¨×›×‘ ××œ×");
    document.getElementById('loader').style.display = 'flex';
    try {
        const res = await fetch('/analyze-ai', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ brand: b, model: m, year: y }) });
        const data = await res.json();
        if(data.success) {
            const ai = data.aiAnalysis;
            const p = document.getElementById('ai-panel'); p.style.display = 'block';
            p.innerHTML = `<div class="ai-card">
                <div class="ai-score-big">${ai.reliability_score}</div>
                <p style="text-align:center; font-size:14px; font-weight:600;">${ai.summary}</p>
                <div class="list-title" style="color:var(--success)">âœ… ×™×ª×¨×•× ×•×ª:</div>
                <ul class="list-ul">${(ai.pros || []).map(p => `<li>${p}</li>`).join('')}</ul>
                <div class="list-title" style="color:var(--danger)">âŒ ×—×¡×¨×•× ×•×ª:</div>
                <ul class="list-ul">${(ai.cons || []).map(c => `<li>${c}</li>`).join('')}</ul>
                <div class="list-title" style="color:var(--warning)">ğŸ› ï¸ ××—×œ×•×ª × ×¤×•×¦×•×ª (×›×œ ×”×× ×•×¢×™×):</div>
                <div style="font-size:11px; color:var(--text-dim); margin-top:5px;">${(ai.common_faults || []).join(', ')}</div>
                <button class="btn-main" onclick="window.goToChecklist()" style="margin-top:25px; background:var(--accent); color:#000;">ğŸ“ ×”××©×š ×œ×‘×“×™×§×” ×¢×¦×××™×ª</button>
            </div>`;
            p.scrollIntoView({ behavior: 'smooth' });
        }
    } catch(e) { alert("×©×’×™××” ×‘×—×™×‘×•×¨"); }
    finally { document.getElementById('loader').style.display = 'none'; }
};

window.goToChecklist = function() {
    document.getElementById('screen-input').style.display = 'none';
    document.getElementById('screen-check').style.display = 'flex';
    const content = document.getElementById('checklist-content'); content.innerHTML = '';
    checklistData.forEach((cat, cIdx) => {
        content.innerHTML += `<div class="category-header"><span class="category-title">${cat.category}</span><div class="category-line"></div></div>`;
        cat.items.forEach((item, iIdx) => {
            const id = `cb-${cIdx}-${iIdx}`;
            content.innerHTML += `<div class="check-item">
                <div class="check-item-header">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div class="info-btn" onclick="window.toggleHow('${id}')">i</div>
                        <span style="font-weight:600; font-size:14px;">${item.name}</span>
                    </div>
                    <div id="${id}" class="cb-custom" onclick="this.classList.toggle('bad'); window.updateScore(${item.weight}, this.classList.contains('bad'))"></div>
                </div>
                <div id="how-${id}" class="how-to-box"><strong>××™×š ×‘×•×“×§×™×?</strong><br>${item.howTo}</div>
            </div>`;
        });
    });
    window.scrollTo(0,0);
};

window.toggleHow = (id) => { const el = document.getElementById('how-'+id); el.style.display = el.style.display === 'block' ? 'none' : 'block'; };
window.updateScore = (w, isBad) => currentScore += isBad ? -w : w;

window.finishCheck = () => {
    document.getElementById('screen-check').style.display = 'none';
    document.getElementById('screen-result').style.display = 'flex';
    const score = Math.max(0, currentScore);
    const g = document.getElementById('final-gauge');
    g.innerText = score;
    let color = score > 85 ? "var(--success)" : (score > 60 ? "var(--warning)" : "var(--danger)");
    g.style.borderColor = color; g.style.color = color;
    document.getElementById('result-text').innerText = score > 85 ? "×¨×›×‘ ×‘××¦×‘ ××¢×•×œ×” âœ…" : (score > 60 ? "××¦×‘ ×¡×‘×™×¨ - ×‘×“×•×§ ×‘××•×¡×š âš ï¸" : "×œ× ××•××œ×¥ ×œ×§× ×™×™×” âŒ");
};

window.findGarage = () => {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => {
            window.open(`https://www.google.com/maps/search/××›×•×Ÿ+×‘×“×™×§×ª+×¨×›×‘/@${p.coords.latitude},${p.coords.longitude},13z`, '_blank');
        }, () => alert("×× × ××¤×©×¨ ××™×§×•×"));
    }
};

document.addEventListener('click', (e) => {
    if(!e.target.closest('.field-group')) {
        document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
    }
});
</script>
</body>
</html>
