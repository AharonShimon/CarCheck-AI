<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCheck AI Pro | Emoji Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-deep: #0f172a;
            --bg-gradient-start: #0f172a;
            --bg-gradient-end: #1e293b;
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(148, 163, 184, 0.1);
            --accent: #38bdf8;
            --accent-glow: rgba(56, 189, 248, 0.3);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --plate-yellow: #facc15;
        }

        body { 
            font-family: 'Heebo', sans-serif; 
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-main); margin: 0; direction: rtl; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .container { 
            padding: 24px; width: 100%; max-width: 480px; box-sizing: border-box; padding-bottom: 100px; 
        }

        /* --- ×›×•×ª×¨×ª ×¨××©×™×ª --- */
        header { text-align: center; margin: 20px 0 35px 0; }
        header h1 { 
            font-size: 28px; font-weight: 900; letter-spacing: 1px; margin: 0; 
            text-transform: uppercase; background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        header h1 span { 
            background: linear-gradient(to right, var(--accent), #60a5fa);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px var(--accent-glow);
        }

        /* --- ×œ×•×—×™×ª ×¨×™×©×•×™ --- */
        .plate-box { 
            background: var(--plate-yellow); padding: 4px; border-radius: 12px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.3); margin: 0 auto 30px auto; width: 100%; max-width: 320px;
            position: relative;
        }
        .plate-inner { 
            border: 3px solid #1e293b; border-radius: 8px; display: flex; align-items: center; padding: 0 10px; height: 60px;
            background: var(--plate-yellow);
        }
        .plate-inner::before {
            content: "IL"; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px;
            width: 25px; height: 100%; background: #003399; border-radius: 4px 0 0 4px; margin-left: 10px;
        }
        .plate-input { 
            background: none; border: none; font-size: 40px; font-weight: 800; width: 100%; 
            text-align: center; outline: none; letter-spacing: 6px; font-family: monospace; color: #1e293b; 
            height: 100%; padding-top: 5px;
        }

        /* --- ×©×“×•×ª ×‘×—×™×¨×” --- */
        .field-group { margin-bottom: 20px; width: 100%; position: relative; }
        label { font-size: 13px; font-weight: 600; color: var(--accent); margin-bottom: 8px; display: block; padding-right: 5px; opacity: 0.9; }
        
        .selector-trigger {
            width: 100%; height: 64px; 
            background: var(--card-bg); backdrop-filter: blur(12px);
            border: 1px solid var(--card-border); border-radius: 16px;
            color: #fff; font-size: 17px; font-weight: 500;
            cursor: pointer; display: flex; justify-content: space-between; align-items: center; 
            padding: 0 20px; box-sizing: border-box; 
            transition: all 0.2s ease; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .selector-trigger:active { transform: scale(0.98); background: rgba(30, 41, 59, 0.9); }
        
        /* --- ×¤×•×¤××¤ ×’×¨×™×“ --- */
        .popup-grid {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #1e293b; border: 1px solid var(--card-border); border-radius: 16px;
            padding: 12px; z-index: 9999; margin-top: 8px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            max-height: 380px; overflow-y: auto; border: 1px solid var(--accent);
        }
        .popup-grid.active { display: block; animation: slideUp 0.25s cubic-bezier(0.16, 1, 0.3, 1); }

        .search-input {
            width: 100%; padding: 14px; margin-bottom: 12px;
            background: #0f172a; border: 1px solid var(--card-border); border-radius: 10px;
            color: white; font-size: 16px; box-sizing: border-box; text-align: right; outline: none;
        }
        .search-input:focus { border-color: var(--accent); }

        .grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .grid-item { 
            padding: 12px 4px; text-align: center; background: rgba(255,255,255,0.03); border-radius: 10px; 
            font-size: 14px; font-weight: 500; cursor: pointer; color: var(--text-muted); 
            border: 1px solid transparent; min-height: 48px; display: flex; align-items: center; justify-content: center;
            line-height: 1.2; word-break: break-word; transition: 0.2s;
        }
        .grid-item:hover { background: var(--accent); color: #000; font-weight: 700; }

        /* --- ×›×¤×ª×•×¨×™× --- */
        .btn-main {
            width: 100%; padding: 18px; border-radius: 16px; border: none;
            font-size: 17px; font-weight: 700; cursor: pointer; color: white;
            background: linear-gradient(135deg, #38bdf8 0%, #2563eb 100%);
            box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.4); 
            margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s; letter-spacing: 0.5px;
        }
        .btn-main:active { transform: scale(0.96); }
        .btn-outline { 
            background: rgba(255,255,255,0.03); border: 1px solid var(--card-border); 
            margin-top: 15px; color: var(--text-muted); width: 100%; padding: 16px; 
            border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer;
        }

        /* --- ×¦'×§ ×œ×™×¡×˜ --- */
        #screen-check { display: none; width: 100%; flex-direction: column; align-items: center; }
        
        .category-header { 
            width: 100%; margin: 30px 0 15px 0; padding-bottom: 8px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); text-align: right; 
        }
        .category-title { color: var(--accent); font-size: 18px; font-weight: 700; text-transform: uppercase; }

        .check-item { 
            width: 100%; background: var(--card-bg); backdrop-filter: blur(8px);
            border-radius: 16px; margin-bottom: 12px; border: 1px solid var(--card-border); 
            display: flex; flex-direction: column; box-sizing: border-box;
        }

        .check-item-header { 
            display: flex; justify-content: space-between; align-items: center; 
            width: 100%; padding: 16px; box-sizing: border-box;
        }

        .main-click-area { display: flex; align-items: center; gap: 15px; flex-grow: 1; cursor: pointer; }
        
        .cb-custom { 
            width: 28px; height: 28px; border: 2px solid #475569; border-radius: 8px; 
            cursor: pointer; background: transparent; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; flex-shrink: 0;
        }
        .cb-custom.bad { background: var(--danger); border-color: var(--danger); transform: scale(1.1); box-shadow: 0 0 10px rgba(239, 68, 68, 0.4); }
        .cb-custom.bad:after { content: 'âœ•'; color: white; font-weight: 900; font-size: 18px; }
        
        .item-name { font-weight: 500; font-size: 16px; color: var(--text-main); text-align: right; line-height: 1.3; }

        .info-btn { 
            width: 28px; height: 28px; border-radius: 50%; 
            background: rgba(56, 189, 248, 0.1); color: var(--accent);
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; font-weight: bold; cursor: pointer; flex-shrink: 0;
        }

        .how-to-box { 
            display: none; background: rgba(15, 23, 42, 0.6); border-top: 1px solid var(--card-border);
            padding: 16px; font-size: 14px; color: var(--text-muted); line-height: 1.6; text-align: right;
            border-bottom-left-radius: 16px; border-bottom-right-radius: 16px;
        }
        .ok-text { color: var(--success); display: flex; align-items: center; gap: 6px; margin-top: 8px; font-weight: 600; background: rgba(16, 185, 129, 0.1); padding: 8px; border-radius: 8px; }

        /* --- ××¡×š ×ª×•×¦××•×ª --- */
        #screen-result { display: none; flex-direction: column; align-items: center; text-align: center; width: 100%; }
        
        .final-gauge { 
            width: 180px; height: 180px; border-radius: 50%; border: 12px solid var(--card-border); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 68px; font-weight: 900; margin: 30px auto; 
            color: #fff; background: var(--card-bg);
            transition: all 0.8s ease;
        }
        
        .defects-list {
            width: 100%; text-align: right; background: rgba(239, 68, 68, 0.08); 
            border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 16px; 
            padding: 20px; margin-bottom: 25px; display: none; box-sizing: border-box;
        }
        .defects-title { color: var(--danger); font-weight: 800; font-size: 16px; margin-bottom: 10px; display: block; }
        .defects-ul { margin: 0; padding-right: 20px; color: #fca5a5; font-size: 15px; line-height: 1.6; }

        #loader { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(5px); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .orbit { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity:0; transform:translateY(15px); } to { opacity:1; transform:translateY(0); } }

    </style>
</head>
<body>

<div id="loader"><div class="orbit"></div><div style="margin-top:20px; color:var(--accent); font-weight:600;">ğŸ¤– ×× ×ª×— × ×ª×•× ×™× ×‘×–××Ÿ ×××ª...</div></div>

<div id="screen-input" class="container">
    <header><h1>ğŸš— CarCheck <span>ULTIMATE</span></h1></header>
    
    <div class="plate-box"><div class="plate-inner"><input id="plate" class="plate-input" type="tel" placeholder="00000000" maxlength="8"></div></div>
    
    <div class="field-group">
        <label>×™×¦×¨×Ÿ ×¨×›×‘</label>
        <div id="brand-trigger" class="selector-trigger" onclick="window.handlePicker('brand')"><span>ğŸš˜ ×‘×—×¨ ×™×¦×¨×Ÿ...</span> <span>â–¼</span></div>
        <div id="brand-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×™×¦×¨×Ÿ..." onkeyup="window.filterGrid('brand', this.value)">
            <div id="brand-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-b">
    </div>

    <div class="field-group">
        <label>×“×’×</label>
        <div id="model-trigger" class="selector-trigger" onclick="window.handlePicker('model')"><span>ğŸï¸ ×‘×—×¨ ×“×’×...</span> <span>â–¼</span></div>
        <div id="model-popup" class="popup-grid">
            <input type="text" class="search-input" placeholder="×—×¤×© ×“×’×..." onkeyup="window.filterGrid('model', this.value)">
            <div id="model-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-m">
    </div>

    <div class="field-group">
        <label>×©× ×ª ×™×™×¦×•×¨</label>
        <div id="year-trigger" class="selector-trigger" onclick="window.handlePicker('year')"><span>ğŸ“… ×‘×—×¨ ×©× ×”...</span> <span>â–¼</span></div>
        <div id="year-popup" class="popup-grid">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; padding:0 10px; font-weight:bold; color:var(--accent);">
                <span onclick="event.stopPropagation(); window.shiftY(-1)">â®</span>
                <span id="y-range-text"></span>
                <span onclick="event.stopPropagation(); window.shiftY(1)">â¯</span>
            </div>
            <div id="year-grid" class="grid-layout"></div>
        </div>
        <input type="hidden" id="val-y">
    </div>
    
    <button class="btn-main" onclick="window.startAI()">ğŸš€ × ×™×ª×•×— ××—×œ×•×ª AI</button>
    <button class="btn-main btn-outline" onclick="window.goToChecklist()">ğŸ“‹ ×“×œ×’ ×œ×‘×“×™×§×ª ×©×˜×—</button>
    
    <div id="ai-panel" style="margin-top: 30px;"></div>
</div>

<div id="screen-check" class="container">
    <header><h1>ğŸ“‹ ×‘×“×™×§×ª <span>×©×˜×—</span></h1></header>
    <div id="checklist-content" style="width: 100%;"></div>
    <div style="position:fixed; bottom:0; left:0; right:0; background:rgba(15, 23, 42, 0.95); backdrop-filter:blur(10px); padding:20px; border-top:1px solid var(--card-border); z-index:100; box-shadow: 0 -10px 30px rgba(0,0,0,0.5);">
        <button class="btn-main" style="background: var(--success); color: #fff; margin:0;" onclick="window.finishCheck()">ğŸ“Š ×¡×™×™× ×•×—×©×‘ ×¦×™×•×Ÿ</button>
    </div>
</div>

<div id="screen-result" class="container">
    <header><h1>ğŸ† ×ª×•×¦××ª <span>×‘×“×™×§×”</span></h1></header>
    
    <div id="final-gauge" class="final-gauge">0</div>
    <div id="result-text" style="font-size:22px; margin-bottom:25px; font-weight:700;"></div>
    
    <div id="defects-container" class="defects-list">
        <span class="defects-title">âš ï¸ ×œ×™×§×•×™×™× ×©× ××¦××•:</span>
        <ul id="defects-ul" class="defects-ul"></ul>
    </div>

    <button class="btn-main" style="background: #0ea5e9;" onclick="window.findGarage()">ğŸ—ºï¸ × ×•×•×˜ ×œ××›×•×Ÿ ×‘×“×™×§×” (Waze)</button>
    <button class="btn-main btn-outline" onclick="location.reload()">ğŸ”„ ×‘×“×™×§×” ×—×“×©×”</button>
</div>

<script>
// === ×××’×¨ × ×ª×•× ×™× ××œ× ===
const carDatabase = {
    "×¡×•×–×•×§×™": ["×¡×•×•×™×¤×˜", "×•×™×˜××¨×”", "×’'×™×× ×™", "×§×¨×•×¡××•×‘×¨", "×‘××œ× ×•", "××™×’× ×™×¡", "××œ×˜×•", "×¡×œ×¨×™×•"],
    "×¡×•×‘××¨×•": ["XV", "×¤×•×¨×¡×˜×¨", "×××•×˜×‘×§", "××™××¤×¨×–×”", "B4", "×§×¨×•×¡×˜×¨×§", "STI", "BRZ", "DL"],
    "×˜×•×™×•×˜×”": ["×§×•×¨×•×œ×”", "×™××¨×™×¡", "RAV4", "C-HR", "×œ× ×“ ×§×¨×•×–×¨", "×¤×¨×™×•×¡", "×”×™×™×œ×§×¡", "×§×××¨×™", "×™××¨×™×¡ ×§×¨×•×¡", "×§×•×¨×•×œ×” ×§×¨×•×¡", "××™×™×’×• X"],
    "×™×•× ×“××™": ["i10", "i20", "i30", "××™×•× ×™×§ 5", "××™×•× ×™×§ 6", "×˜×•×¡×•×Ÿ", "×¡× ×˜×” ×¤×”", "×§×•× ×”", "××œ× ×˜×¨×”", "×‘××™×•×Ÿ", "×•×œ×•×¡×˜×¨", "i25"],
    "×§×™×”": ["×¤×™×§× ×˜×•", "×¡×¤×•×¨×˜××–'", "× ×™×¨×•", "×¡×˜×•× ×™×§", "×¡×•×¨× ×˜×•", "×§×¨× ×™×‘×œ", "EV6", "EV9", "×¡×™×“", "×¨×™×•", "××•×¤×˜×™××”", "×¡×œ×˜×•×¡"],
    "×××–×“×”": ["2", "3", "6", "CX-3", "CX-5", "CX-30", "CX-60", "CX-9", "MX-5"],
    "×¡×§×•×“×”": ["××•×§×˜×‘×™×”", "×¡×•×¤×¨×‘", "×§×•×“×™××§", "×§××¨×•×§", "×§×××™×§", "×¤××‘×™×”", "×¡×§××œ×”", "×× ×™×™××§", "×™×™×˜×™"],
    "×¤×•×œ×§×¡×•×•×’×Ÿ": ["×’×•×œ×£", "×¤×•×œ×•", "×˜×™×’×•××Ÿ", "×¤××¡××˜", "ID.4", "T-Roc", "×˜×•×¨××Ÿ", "×’'×˜×”", "×—×™×¤×•×©×™×ª"],
    "×××•×“×™": ["A1", "A3", "A4", "A5", "A6", "Q2", "Q3", "Q5", "Q7", "e-tron"],
    "××¨×¦×“×¡": ["A-Class", "C-Class", "E-Class", "S-Class", "GLA", "GLC", "GLE", "EQE", "EQS", "CLA"],
    "×‘.×.×•×•": ["×¡×“×¨×” 1", "×¡×“×¨×” 2", "×¡×“×¨×” 3", "×¡×“×¨×” 4", "×¡×“×¨×” 5", "X1", "X3", "X5", "X6", "i4"],
    "×©×‘×¨×•×œ×˜": ["×¡×¤××¨×§", "×˜×¨××•×•×¨×¡", "××§×•×•×™× ×•×§×¡", "×‘×œ×™×™×–×¨", "×¡×™×œ×‘×¨×“×•", "×××œ×™×‘×•", "×§×¨×•×–"],
    "××™×¦×•×‘×™×©×™": ["×××•×˜×œ× ×“×¨", "ASX", "×¡×¤×™×™×¡ ×¡×˜××¨", "××§×œ×™×¤×¡ ×§×¨×•×¡", "×œ× ×¡×¨", "×¤××’'×¨×•", "×”×× ×˜×¨"],
    "×¤×•×¨×“": ["×¤×•×§×•×¡", "×§×•×’×”", "××§×¡×¤×œ×•×¨×¨", "×‘×¨×•× ×§×•", "××•×¡×˜× ×’", "×¨×™×™× ×’'×¨", "×¤×™××¡×˜×”"],
    "×¡×™××˜": ["××™×‘×™×–×”", "×œ××•×Ÿ", "××¨×•× ×”", "××˜×§×”", "×˜×¨××§×•"],
    "BYD": ["Atto 3", "Dolphin", "Seal", "Tang", "Han"],
    "MG": ["MG4", "MG5", "ZS EV", "EHS", "Marvel R", "MG3"],
    "×œ×§×¡×•×¡": ["NX", "RX", "UX", "ES", "IS", "LS"],
    "×’'× ×¡×™×¡": ["G70", "G80", "G90", "GV60", "GV70", "GV80"],
    "×§×•×¤×¨×”": ["×¤×•×¨×× ×˜×•×¨", "×œ××•×Ÿ", "××˜×§×”", "×‘×•×¨×Ÿ"]
};

// === 35 ×‘×“×™×§×•×ª ×©×˜×— ×§×¤×“× ×™×•×ª ×¢× ××™××•×’'×™× ===
const checklistData = [
    {
        category: "ğŸ”© ×× ×•×¢ ×•××¢×¨×›×ª ×§×™×¨×•×¨ (×§×¨×™×˜×™)",
        items: [
            { name: "ğŸ›¢ï¸ ×¤×ª×— ××™×œ×•×™ ×©××Ÿ ('×˜×—×™× ×”')", weight: 25, howTo: "×¤×ª×— ××ª ×”×¤×§×§. ×§×¦×£ ×œ×‘×Ÿ/×—×•× = ××™× ×‘×©××Ÿ (×¨××© ×× ×•×¢).", ok: "×¤×§×§ × ×§×™ ××©××Ÿ ×©×¨×•×£ ××• ×§×¦×£." },
            { name: "ğŸ«§ ×‘×•×¢×•×ª ×‘××™×›×œ ×¢×™×‘×•×™", weight: 25, howTo: "×›×©×”×× ×•×¢ ×¤×•×¢×œ, ×”×× ×¢×•×œ×•×ª ×‘×•×¢×•×ª ×‘××™×›×œ ×”××™×?", ok: "××™× ×©×§×˜×™× ×œ×œ× ×‘×•×¢×•×ª ××•×•×™×¨." },
            { name: "ğŸŒ¬ï¸ × ×©×™××ª ×× ×•×¢ (Blow-By)", weight: 25, howTo: "×”× ×— ×¤×§×§ ×©××Ÿ ×”×¤×•×š ×›×©×”×× ×•×¢ ×¤×•×¢×œ. ×”×× ×”×•× ×¢×£?", ok: "×”×¤×§×§ ×¨×•×¢×“ ×§×œ×•×ª ×‘××§×•× ×•×œ× ×¢×£." },
            { name: "â›½ ×¨×™×— ×“×œ×§ ×—×¨×™×£", weight: 25, howTo: "×”×¨×— ×¡×‘×™×‘ ×”×× ×•×¢ ×•×‘×ª×•×š ×”×¨×›×‘ (××•×©×‘ ××—×•×¨×™).", ok: "××™×Ÿ ×¨×™×— ×“×œ×§." },
            { name: "âš« ×‘×•×¥ ×©××Ÿ (Sludge)", weight: 20, howTo: "×”××¨ ×¢× ×¤× ×¡ ×œ×ª×•×š ×¤×ª×— ××™×œ×•×™ ×”×©××Ÿ. ××©×§×¢ ×©×—×•×¨?", ok: "×—×œ×§×™ ×”××ª×›×ª ×‘×¤× ×™× × ×¨××™× × ×§×™×™×." },
            { name: "ğŸ“ ××“×™×“ ×©××Ÿ (××¤×œ×¡ ×•×¦×‘×¢)", weight: 15, howTo: "×‘×“×•×§ ×©××Ÿ. ×©×—×•×¨ ××“×™? ×—×•×¡×¨ ×©××Ÿ?", ok: "×©××Ÿ ×‘×’×•×•×Ÿ ×“×‘×©/×—×•×, ×‘××¤×œ×¡ ×”× ×›×•×Ÿ." },
            { name: "ğŸ’§ × ×–×™×œ×•×ª ×©××Ÿ ×˜×¨×™×•×ª", weight: 15, howTo: "×”×¡×ª×›×œ ××ª×—×ª ×œ×¨×›×‘ ×•×¢×œ ×”×‘×œ×•×§. ×¨×˜×™×‘×•×ª?", ok: "×× ×•×¢ ×™×‘×© ×•××‘×§×ª×™." },
            { name: "ğŸ§ª ×¦×‘×¢ × ×•×–×œ ×§×™×¨×•×¨", weight: 10, howTo: "××™× ×—×•××™×? ×—×œ×•×“×”?", ok: "× ×•×–×œ ×‘×¦×‘×¢ ××§×•×¨×™ (×•×¨×•×“/×™×¨×•×§) ×•×¦×œ×•×œ." },
            { name: "ğŸ”Š ×¨×¢×© ×× ×•×¢ (×ª×§×ª×•×§×™×)", weight: 15, howTo: "×”×§×©×‘ ×œ×× ×•×¢ ×‘×¡×¨×§. ×¨×¢×© ××ª×›×ª×™?", ok: "×¢×‘×•×“×” ×¢×’×•×œ×” ×•×©×§×˜×”." },
            { name: "âœŠ ×œ×—×¥ ×‘×¦× ×¨×ª ×¨×“×™××˜×•×¨", weight: 15, howTo: "×›×©×”×× ×•×¢ ×—×, ×œ×—×¥ ×¢×œ ×”×¦×™× ×•×¨ ×”×¢×œ×™×•×Ÿ. ×§×©×” ×›××‘×Ÿ?", ok: "×”×¦×™× ×•×¨ ×—× ×•×’××™×© ××¢×˜ ×‘×œ×—×™×¦×”." },
            { name: "ğŸŒ€ ×××•×•×¨×¨ ×¨×“×™××˜×•×¨", weight: 15, howTo: "×”×¤×¢×œ ××–×’×Ÿ. ×”×× ×”×××•×•×¨×¨ × ×›× ×¡ ×œ×¤×¢×•×œ×”?", ok: "×”×××•×•×¨×¨ ×¢×•×‘×“ ×—×–×§ ××™×“." }
        ]
    },
    {
        category: "âš™ï¸ ×’×™×¨ ×•×”× ×¢×”",
        items: [
            { name: "ğŸ¥Š ××›×” ×‘×©×™×œ×•×‘ ×”×™×œ×•×š", weight: 15, howTo: "×”×¢×‘×¨ P ×œ-D. ×™×© ×“×¤×™×§×”?", ok: "×©×™×œ×•×‘ ×—×œ×§." },
            { name: "â›¸ï¸ ×”×—×œ×§×” ×‘×”××¦×”", weight: 20, howTo: "×ª×Ÿ ×’×–. ×”×˜×•×¨×™× ×¢×•×œ×™× ×•×”×¨×›×‘ ×œ× ×–×–?", ok: "×ª××•×¦×” ××™×™×“×™×ª." },
            { name: "ğŸ«¨ ×¨×¢×™×“×•×ª ×‘× ×¡×™×¢×”", weight: 15, howTo: "×¨×¢×™×“×•×ª ×‘×”×’×” ×‘-100 ×§×\"×©?", ok: "× ×¡×™×¢×” ×—×œ×§×”." },
            { name: "ğŸ”© ×¨×¢×©×™ ×¦×™×¨×™×•×ª (×§×œ×™×§×™×)", weight: 15, howTo: "×¡×™×‘×•×‘ ××œ× ×‘× ×¡×™×¢×” ××™×˜×™×ª. ×¨×¢×© ×ª×§×ª×•×§?", ok: "×©×§×˜ ××•×—×œ×˜ ×‘×¡×™×‘×•×‘." },
            { name: "ğŸ©¸ ××¦×‘ ×©××Ÿ ×’×™×¨", weight: 10, howTo: "×× ×™×© ××“×™×“ - ×©××Ÿ ×©×¨×•×£?", ok: "×©××Ÿ ××“×•×/×‘×”×™×¨ ×•× ×§×™." }
        ]
    },
    {
        category: "ğŸ› ï¸ ×©×œ×“×” ×•××¨×›×‘",
        items: [
            { name: "ğŸ§² ××‘×—×Ÿ ×”××’× ×˜ (×¤×—×—×•×ª)", weight: 15, howTo: "×”××’× ×˜ × ×•×¤×œ ××”×›× ×£? ×™×© ×©×¤×›×˜×œ.", ok: "××’× ×˜ × ×ª×¤×¡ ×—×–×§." },
            { name: "ğŸ”¥ × ×§×•×“×•×ª ×¨×™×ª×•×š ×‘×’×•××™×•×ª", weight: 20, howTo: "××©×•×š ×’×•××™×•×ª ×“×œ×ª. ×™×© × ×§×•×“×•×ª ×¢×’×•×œ×•×ª?", ok: "× ×§×•×“×•×ª ××§×•×¨×™×•×ª." },
            { name: "ğŸ”§ ×‘×¨×’×™ ×›× ×¤×™×™× (×¤×™×¨×•×§)", weight: 12, howTo: "×¦×‘×¢ ××ª×§×œ×£ ×¢×œ ×”×‘×¨×’×™×?", ok: "×‘×¨×’×™× ××§×•×¨×™×™× ×œ×œ× ×¡×™×× ×™ ××¤×ª×—." },
            { name: "ğŸŒŠ ×¨×˜×™×‘×•×ª ×‘×ª× ××˜×¢×Ÿ", weight: 15, howTo: "×”×¨× ×©×˜×™×— ×‘×‘×’××–'. ×™×© ××™×?", ok: "×™×‘×© ×•× ×§×™." },
            { name: "ğŸ¨ ×”×‘×“×œ×™ ×’×•×•×Ÿ ×‘×¦×‘×¢", weight: 10, howTo: "×”×¡×ª×›×œ ×‘×©××© ×¢×œ ×”×“×œ×ª×•×ª.", ok: "×¦×‘×¢ ××—×™×“." },
            { name: "ğŸ“ ×¡×™××˜×¨×™×” ×‘××¨×•×•×—×™×", weight: 10, howTo: "×¨×•×•×—×™× ×©×•×•×™× ×‘×™×Ÿ ××›×¡×” ×× ×•×¢ ×œ×›× ×¤×™×™×?", ok: "×§×•×•×™× ×™×©×¨×™×." },
            { name: "ğŸ¦€ ×—×œ×•×“×” ×‘×ª×—×ª×™×ª ×”×¨×›×‘", weight: 15, howTo: "×”×ª×›×•×¤×£ ×•×”×¡×ª×›×œ ×œ××˜×”.", ok: "× ×§×™ ××—×œ×•×“×” ×¢××•×§×”." }
        ]
    },
    {
        category: "âš¡ ×—×©××œ ×•×¤× ×™×",
        items: [
            { name: "ğŸ’¡ × ×•×¨×•×ª ××–×”×¨×” ×“×•×œ×§×•×ª", weight: 20, howTo: "×”×× × ×•×¨×ª ×× ×•×¢ ×“×•×œ×§×ª?", ok: "×œ×•×— × ×§×™ ×× ×•×¨×•×ª." },
            { name: "â„ï¸ ××–×’×Ÿ (×§×•×¨)", weight: 10, howTo: "×”×× ××§×¨×¨ ××™×“?", ok: "××§×¤×™×." },
            { name: "ğŸ”¥ ×—×™××•× (×¨×“×™××˜×•×¨)", weight: 10, howTo: "×”×× ××•×¦×™× ×—×•×?", ok: "××—×× ×—×–×§." },
            { name: "ğŸªŸ ×—×œ×•× ×•×ª ×—×©××œ", weight: 5, howTo: "×‘×“×•×§ ××ª ×›×œ ×”-4.", ok: "×¢×•×œ×™× ×•×™×•×¨×“×™× ×—×œ×§." },
            { name: "ğŸ”’ × ×¢×™×œ×” ××¨×›×–×™×ª", weight: 5, howTo: "× ×¢×œ ×•×¤×ª×— ××ª ×”×¨×›×‘.", ok: "×›×œ ×”×“×œ×ª×•×ª ××’×™×‘×•×ª." },
            { name: "ğŸ’º ××¦×‘ ×¨×™×¤×•×“×™×", weight: 5, howTo: "×§×¨×¢×™× ××• ×›×ª××™×?", ok: "×©×œ× ×•× ×§×™." },
            { name: "ğŸ› × ×–×§×™ ×”×¦×¤×”", weight: 20, howTo: "×—×•×œ ××ª×—×ª ×œ×©×˜×™×—?", ok: "× ×§×™ ×•×™×‘×©." }
        ]
    },
    {
        category: "ğŸ› ×¦××™×’×™× ×•×‘×˜×™×—×•×ª",
        items: [
            { name: "ğŸ“… ×ª××¨×™×š ×¦××™×’×™×", weight: 5, howTo: "×—×¤×© 4 ×¡×¤×¨×•×ª (×œ××©×œ 1023).", ok: "×¢×“ 4 ×©× ×™× ×¢×œ ×”×›×‘×™×©." },
            { name: "ğŸŒµ ×™×•×‘×© ×‘×¦××™×’×™×", weight: 5, howTo: "×¡×“×§×™× ×‘×¦×“ ×”×¦××™×’?", ok: "×’×•××™ ×˜×¨×™." },
            { name: "ğŸ© ×’×œ×’×œ ×¨×–×¨×‘×™/×¢×¨×›×”", weight: 5, howTo: "×”×× ×§×™×™×?", ok: "× ××¦× ×•×ª×§×™×Ÿ." },
            { name: "ğŸ—ï¸ ×—×’×•×¨×•×ª ×‘×˜×™×—×•×ª", weight: 5, howTo: "××©×•×š ×—×–×§ - × × ×¢×œ?", ok: "×× ×’× ×•×Ÿ ×¢×•×‘×“." },
            { name: "ğŸŒ§ï¸ ×•×™×©×¨×™× ×•××ª×™×–×™×", weight: 5, howTo: "×× ×§×™× ×˜×•×‘?", ok: "×’××™×©×™× ×•×¢×•×‘×“×™×." }
        ]
    }
];

let yBase = 2018; let currentScore = 100;

window.handlePicker = function(type) {
    const target = document.getElementById(type + '-popup');
    const isOpen = target.classList.contains('active');
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
    if (!isOpen) {
        target.classList.add('active');
        if(type === 'brand') renderGrid('brand', Object.keys(carDatabase));
        if(type === 'year') renderYears();
        if(type === 'model') renderGrid('model', carDatabase[document.getElementById('val-b').value] || []);
    }
};

function renderGrid(type, items, query = "") {
    const g = document.getElementById(type + '-grid'); g.innerHTML = '';
    items.sort((a,b) => a.localeCompare(b, 'he'));
    
    if (items.length === 0 && query.length > 0) {
        const d = document.createElement('div'); d.className = 'grid-item'; d.style.gridColumn = "1/-1";
        d.innerHTML = `×”×©×ª××© ×‘: "${query}"`;
        d.onclick = () => selectItem(type, query);
        g.appendChild(d);
        return;
    }

    items.forEach(item => {
        const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = item;
        d.onclick = () => selectItem(type, item);
        g.appendChild(d);
    });
}

function selectItem(type, value) {
    document.getElementById('val-' + type.charAt(0)).value = value;
    document.getElementById(type + '-trigger').innerHTML = `<span>${value}</span> <span class="arrow">â–¼</span>`;
    if(type === 'brand') { document.getElementById('val-m').value = ''; document.getElementById('model-trigger').innerHTML = `<span>ğŸï¸ ×‘×—×¨ ×“×’×...</span> <span class="arrow">â–¼</span>`; }
    document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
}

window.filterGrid = function(type, query) {
    let source = type === 'brand' ? Object.keys(carDatabase) : (carDatabase[document.getElementById('val-b').value] || []);
    renderGrid(type, source.filter(i => i.toLowerCase().includes(query.toLowerCase())), query);
};

function renderYears() {
    const g = document.getElementById('year-grid'); g.innerHTML = '';
    document.getElementById('y-range-text').innerText = `${yBase}-${yBase+8}`;
    for(let i=0; i<9; i++){
        let y = yBase+i; let d = document.createElement('div'); d.className = 'grid-item'; d.innerText = y;
        d.onclick = () => selectItem('year', y);
        g.appendChild(d);
    }
}
window.shiftY = function(n) { yBase += (n * 9); renderYears(); };

window.startAI = async function() {
    const b = document.getElementById('val-b').value;
    const m = document.getElementById('val-m').value;
    const y = document.getElementById('val-y').value;
    if(!b || !m || !y) return alert("×× × ×‘×—×¨ ×¨×›×‘ ××œ×");
    document.getElementById('loader').style.display = 'flex';
    try {
        const res = await fetch('/analyze-ai', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ brand: b, model: m, year: y }) });
        const data = await res.json();
        if(data.success) {
            const ai = data.aiAnalysis;
            const p = document.getElementById('ai-panel'); p.style.display = 'block';
            p.innerHTML = `<div style="background:rgba(30, 41, 59, 0.8); padding:16px; border-radius:16px; margin-top:20px; border:1px solid rgba(56, 189, 248, 0.3);">
                <div style="font-size:42px; font-weight:900; color:var(--accent); text-align:center; margin-bottom:5px;">${ai.reliability_score}</div>
                <p style="text-align:center; font-size:15px; font-weight:600; margin-bottom:15px;">${ai.summary}</p>
                <div style="text-align:right;">
                    <div style="color:var(--success); font-weight:bold; margin-bottom:5px;">âœ… ×™×ª×¨×•× ×•×ª:</div>
                    <ul style="font-size:13px; padding-right:20px; color:#cbd5e1; margin-bottom:10px;">${(ai.pros || []).map(p => `<li>${p}</li>`).join('')}</ul>
                    <div style="color:var(--danger); font-weight:bold; margin-bottom:5px;">âŒ ×—×¡×¨×•× ×•×ª:</div>
                    <ul style="font-size:13px; padding-right:20px; color:#cbd5e1;">${(ai.cons || []).map(c => `<li>${c}</li>`).join('')}</ul>
                </div>
                <button class="btn-main" onclick="window.goToChecklist()" style="font-size:16px; margin-top:15px;">×”××©×š ×œ×‘×“×™×§×”</button>
            </div>`;
            p.scrollIntoView({ behavior: 'smooth' });
        }
    } catch(e) { alert("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ-AI"); }
    finally { document.getElementById('loader').style.display = 'none'; }
};

window.goToChecklist = function() {
    document.getElementById('screen-input').style.display = 'none';
    document.getElementById('screen-check').style.display = 'flex';
    const content = document.getElementById('checklist-content'); content.innerHTML = '';
    currentScore = 100;
    
    checklistData.forEach((cat, cIdx) => {
        content.innerHTML += `<div class="category-header"><span class="category-title">${cat.category}</span></div>`;
        cat.items.forEach((item, iIdx) => {
            const id = `cb-${cIdx}-${iIdx}`;
            content.innerHTML += `<div class="check-item">
                <div class="check-item-header">
                    <div class="main-click-area" onclick="window.toggleCheck('${id}', ${item.weight}, '${item.name}')">
                        <div id="${id}" class="cb-custom" data-name="${item.name}"></div>
                        <span class="item-name">${item.name}</span>
                    </div>
                    <div class="info-btn" onclick="window.toggleHow('${id}')">?</div>
                </div>
                <div id="how-${id}" class="how-to-box">${item.howTo} <span class="ok-text">âœ” ${item.ok}</span></div>
            </div>`;
        });
    });
    window.scrollTo(0,0);
};

window.toggleCheck = (id, weight, name) => {
    const el = document.getElementById(id);
    const isBad = el.classList.contains('bad');
    el.classList.toggle('bad');
    currentScore += isBad ? weight : -weight;
    
    // × ×™×”×•×œ ×¨×©×™××ª ×”×œ×™×§×•×™×™×
    if (!isBad) {
        badItemsNames.push(name);
    } else {
        badItemsNames = badItemsNames.filter(item => item !== name);
    }
};

window.toggleHow = (id) => { const el = document.getElementById('how-'+id); el.style.display = el.style.display === 'block' ? 'none' : 'block'; };

// ×©××™×¨×ª ×©××•×ª ×”×œ×™×§×•×™×™×
let badItemsNames = [];

window.finishCheck = () => {
    document.getElementById('screen-check').style.display = 'none';
    document.getElementById('screen-result').style.display = 'flex';
    const score = Math.max(0, currentScore);
    
    // ×× ×™××¦×™×” ×œ×¦×™×•×Ÿ
    const g = document.getElementById('final-gauge');
    let start = 0;
    const animate = (timestamp) => {
        if (!start) start = timestamp;
        const progress = Math.min((timestamp - start) / 1000, 1);
        g.innerText = Math.floor(progress * score);
        if (progress < 1) window.requestAnimationFrame(animate);
    };
    window.requestAnimationFrame(animate);

    // ×¦×‘×¢×™×
    let color = score > 85 ? "var(--success)" : (score > 60 ? "var(--warning)" : "var(--danger)");
    g.style.borderColor = color; 
    g.style.color = "#fff";
    g.style.boxShadow = `0 0 30px ${color}`;

    document.getElementById('result-text').innerText = score > 85 ? "ğŸ’¯ ×¨×›×‘ ×‘××¦×‘ ××¢×•×œ×”!" : (score > 60 ? "âš ï¸ ××¦×‘ ×¡×‘×™×¨ - ×œ×‘×“×•×§ ×‘××•×¡×š." : "âŒ ×œ× ××•××œ×¥ ×œ×§× ×™×™×”.");
    document.getElementById('result-text').style.color = color;

    // ×”×¦×’×ª ×œ×™×§×•×™×™×
    const list = document.getElementById('defects-ul');
    list.innerHTML = '';
    if (badItemsNames.length > 0) {
        document.getElementById('defects-container').style.display = 'block';
        badItemsNames.forEach(name => {
            const li = document.createElement('li');
            li.innerText = name;
            list.appendChild(li);
        });
    } else {
        document.getElementById('defects-container').style.display = 'none';
    }
};

window.findGarage = () => {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => {
            window.open(`https://waze.com/ul?q=××›×•×Ÿ%20×‘×“×™×§×ª%20×¨×›×‘&ll=${p.coords.latitude},${p.coords.longitude}&navigate=yes`, '_blank');
        }, () => window.open(`https://waze.com/ul?q=××›×•×Ÿ%20×‘×“×™×§×ª%20×¨×›×‘&navigate=yes`, '_blank'));
    }
};

document.addEventListener('click', (e) => {
    if(!e.target.closest('.field-group')) {
        document.querySelectorAll('.popup-grid').forEach(p => p.classList.remove('active'));
    }
});
</script>
</body>
</html>
