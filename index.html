<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CarCheck AI Pro</title>
    <style>
        :root { --primary: #00F2FF; --accent: #7000FF; --bg: #0A0A0C; --card: #16161D; --text: #E0E0E0; --danger: #FF3B3B; --success: #00FF85; --warning: #FFB800; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); margin: 0; direction: rtl; }
        .container { padding: 20px; max-width: 500px; margin: auto; padding-bottom: 50px; }
        h1 { text-align:center; margin-bottom: 20px; }

        /* ×œ×•×—×™×ª */
        .plate-container { background: #FFB800; padding: 5px; border-radius: 12px; border: 3px solid #000; display: flex; align-items: center; position: relative; margin-bottom: 15px; }
        .plate-input { background: none; border: none; font-size: 35px; font-weight: 900; width: 100%; text-align: center; outline: none; color: #000; letter-spacing: 3px; font-family: monospace; }
        .il-tag { background: #003399; color: white; padding: 3px 6px; border-radius: 4px; font-size: 10px; position: absolute; left: 8px; font-weight: bold; display: flex; flex-direction: column; align-items: center; line-height: 1; }

        /* ×›×¤×ª×•×¨×™× */
        .btn-plate { background: #007AFF; color: white; border: none; padding: 12px; border-radius: 10px; font-size: 16px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 25px; }
        .btn-ai { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border: none; padding: 18px; border-radius: 16px; font-size: 18px; font-weight: 700; width: 100%; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 20px rgba(0, 242, 255, 0.25); }

        /* ×©×“×•×ª */
        .ios-field { width: 100%; padding: 15px; background: var(--card); border: 1px solid #333; color: #fff; border-radius: 14px; margin-bottom: 12px; box-sizing: border-box; font-size: 17px; transition: 0.3s; }
        .ios-field:focus { border-color: var(--primary); outline: none; }

        /* ×ª×•×¦××•×ª */
        #ai-card { display: none; background: rgba(22, 22, 29, 0.95); border: 1px solid rgba(0, 242, 255, 0.3); border-radius: 18px; padding: 20px; margin: 20px 0; animation: fadeIn 0.5s; }
        #status-msg { text-align: center; margin-bottom: 10px; font-weight: bold; min-height: 20px; font-size: 14px; }
        
        /* ×˜×¢×™× ×” */
        #loading-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ××¡×š ×‘×“×™×§×” */
        .check-item { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 8px; display: flex; align-items: center; }
        .cb { width: 24px; height: 24px; border: 2px solid #555; border-radius: 6px; margin-left: 15px; }
        .cb.checked { background: var(--danger); border-color: var(--danger); }
        .category { margin-top: 25px; color: var(--primary); font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <p id="loading-text" style="color: white; margin-top: 15px;">×˜×•×¢×Ÿ...</p>
</div>

<div id="screen-input" class="container">
    <h1>CarCheck <span style="color:var(--primary)">AI</span></h1>
    
    <label style="color:#888; font-size:14px;">×©×œ×‘ 1: ××™×ª×•×¨ ×¤×¨×˜×™× (××•×¤×¦×™×•× ×œ×™)</label>
    <div class="plate-container">
        <div class="il-tag"><span>IL</span><span>×™×©×¨××œ</span></div>
        <input id="plate" class="plate-input" type="tel" placeholder="12345678" maxlength="8" inputmode="numeric">
    </div>
    <button class="btn-plate" onclick="getCarDetails()">ğŸ” ××ª×¨ ×¤×¨×˜×™ ×¨×›×‘ ×××©×¨×“ ×”×ª×—×‘×•×¨×”</button>
    
    <div id="status-msg"></div>

    <div style="border-top: 1px solid #333; padding-top: 20px; margin-top: 10px;">
        <label style="color:#888; font-size:14px; display:block; margin-bottom:10px;">×©×œ×‘ 2: ×¤×¨×˜×™ ×”×¨×›×‘ (×œ× ×™×ª×•×— AI)</label>
        <input id="brand" class="ios-field" placeholder="×™×¦×¨×Ÿ (×œ××©×œ: ×××–×“×”)">
        <input id="model" class="ios-field" placeholder="×“×’× (×œ××©×œ: 3)">
        <input id="year" class="ios-field" type="number" placeholder="×©× ×”" inputmode="numeric">
        
        <button class="btn-ai" onclick="analyzeAI()">ğŸ¤– × ×ª×— ×××™× ×•×ª ×•×ª×§×œ×•×ª (AI)</button>
    </div>

    <div id="ai-card">
        <div id="ai-text" style="line-height:1.6; color:#ddd;"></div>
    </div>

    <button class="btn-plate" style="background:#222; margin-top:30px; border:1px solid #444;" onclick="goToInspection()">×”××©×š ×œ×¦'×§ ×œ×™×¡×˜ ×‘×“×™×§×” â”</button>
</div>

<div id="screen-check" class="container" style="display:none">
    <h2 id="display-name" style="text-align:center; color:white"></h2>
    
    <div id="checklist-ai-container"></div>

    <div id="list-content"></div>
    
    <button class="btn-plate" style="background:#25D366; margin-top:20px;" onclick="shareToWhatsApp()">×©×ª×£ ×‘×•×•××˜×¡××¤ ğŸŸ¢</button>
    <button class="btn-plate" style="background:transparent; color:#888;" onclick="location.reload()">×—×–×¨×” ×œ×”×ª×—×œ×”</button>
</div>

<script>
// ×¤×•× ×§×¦×™×” 1: ×¨×§ ××©×¨×“ ×”×ª×—×‘×•×¨×”
async function getCarDetails() {
    const plate = document.getElementById('plate').value;
    const status = document.getElementById('status-msg');
    
    if(plate.length < 7) {
        status.innerHTML = "<span style='color:var(--warning)'>××¡×¤×¨ ×œ×•×—×™×ª ×§×¦×¨ ××“×™</span>";
        return;
    }

    showLoading("××—×¤×© ×‘××©×¨×“ ×”×ª×—×‘×•×¨×”...");
    status.innerHTML = "";

    try {
        const res = await fetch('/get-car-details', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ plate })
        });
        const data = await res.json();

        if (data.success) {
            document.getElementById('brand').value = data.data.brand;
            document.getElementById('model').value = data.data.model;
            document.getElementById('year').value = data.data.year;
            status.innerHTML = "<span style='color:var(--success)'>âœ… ×¤×¨×˜×™× ××•×ª×¨×• ×•××•×œ××•!</span>";
        } else {
            if (data.error === "NOT_FOUND") status.innerHTML = "<span style='color:var(--warning)'>âš ï¸ ×”×¨×›×‘ ×œ× × ××¦× ×‘×××’×¨. ××œ× ×™×“× ×™×ª.</span>";
            else status.innerHTML = "<span style='color:var(--danger)'>âŒ ×©×’×™××ª ×ª×§×©×•×¨×ª ×œ×××©×œ×”. ××œ× ×™×“× ×™×ª.</span>";
        }
    } catch (e) {
        status.innerHTML = "<span style='color:var(--danger)'>âŒ ×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª</span>";
    } finally {
        hideLoading();
    }
}

// ×¤×•× ×§×¦×™×” 2: ×¨×§ AI
async function analyzeAI() {
    const brand = document.getElementById('brand').value;
    const model = document.getElementById('model').value;
    const year = document.getElementById('year').value;
    const aiCard = document.getElementById('ai-card');

    if(!brand || !model) {
        alert("×—×•×‘×” ×œ××œ× ×™×¦×¨×Ÿ ×•×“×’× (××• ×œ××ª×¨ ×œ×¤×™ ×œ×•×—×™×ª) ×œ×¤× ×™ ×”×¤×¢×œ×ª ×”-AI");
        return;
    }

    showLoading("×”-AI ×× ×ª×— × ×ª×•× ×™×...");
    aiCard.style.display = "none";

    try {
        const res = await fetch('/analyze-ai', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ brand, model, year })
        });
        const data = await res.json();

        if (data.success) {
            aiCard.style.display = "block";
            // ×¤×™×¨××•×˜ ×™×¤×” ×œ×˜×§×¡×˜
            document.getElementById('ai-text').innerHTML = data.aiAnalysis
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color:var(--primary)">$1</strong>')
                .replace(/\*/g, 'â€¢');
        } else {
            alert("×©×’×™××” ×‘× ×™×ª×•×— AI. × ×¡×” ×©×•×‘.");
        }
    } catch (e) {
        alert("×©×’×™××ª ×ª×§×©×•×¨×ª.");
    } finally {
        hideLoading();
    }
}

function goToInspection() {
    if(!document.getElementById('brand').value) {
        alert("××œ× ×¤×¨×˜×™ ×¨×›×‘ ×§×•×“×.");
        return;
    }
    document.getElementById('screen-input').style.display = 'none';
    document.getElementById('screen-check').style.display = 'block';
    
    document.getElementById('display-name').innerText = 
        document.getElementById('brand').value + " " + document.getElementById('model').value;

    // ×”×¢×ª×§×ª ×”-AI ×œ××¡×š ×”×‘×“×™×§×”
    const aiText = document.getElementById('ai-text').innerHTML;
    if(aiText) {
        document.getElementById('checklist-ai-container').innerHTML = 
            `<div style="background:rgba(0,242,255,0.1); border:1px solid var(--primary); padding:15px; border-radius:12px; margin-bottom:20px;">
                <strong>âš ï¸ ×¡×™×›×•× AI:</strong><br>${aiText}
             </div>`;
    }

    // ×‘× ×™×™×ª ×”×¦'×§ ×œ×™×¡×˜
    const items = {
        "×× ×•×¢": ["× ×–×™×œ×•×ª ×©××Ÿ", "××¤×œ×¡ ××™×", "×¨×¢×© ×× ×•×¢", "×¢×©×Ÿ"],
        "×’×™×¨": ["×”×¢×‘×¨×ª ×”×™×œ×•×›×™×", "××›×•×ª ×‘×’×™×¨", "×¨×¢×™×“×•×ª"],
        "×©×œ×“×”": ["×ª××•× ×•×ª", "×ª×™×§×•× ×™ ×¦×‘×¢", "×—×œ×•×“×”", "×¤× ×¡×™×"],
        "×¤× ×™×": ["××–×’×Ÿ", "×—×œ×•× ×•×ª", "×¨×™×¤×•×“×™×", "× ×•×¨×•×ª ××–×”×¨×”"]
    };
    
    let html = "";
    for(let cat in items) {
        html += `<div class="category">${cat}</div>`;
        items[cat].forEach(i => {
            html += `<div class="check-item" onclick="this.querySelector('.cb').classList.toggle('checked')"><div class="cb"></div><span>${i}</span></div>`;
        });
    }
    document.getElementById('list-content').innerHTML = html;
}

function showLoading(text) {
    document.getElementById('loading-text').innerText = text;
    document.getElementById('loading-overlay').style.display = 'flex';
}
function hideLoading() {
    document.getElementById('loading-overlay').style.display = 'none';
}

function shareToWhatsApp() {
    const name = document.getElementById('display-name').innerText;
    const ai = document.getElementById('ai-text').innerText;
    window.open(`https://wa.me/?text=*×‘×“×™×§×ª ×¨×›×‘:* ${name}%0A%0A*AI:* ${ai}`, '_blank');
}
</script>
</body>
</html>
